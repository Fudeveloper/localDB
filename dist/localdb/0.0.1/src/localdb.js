define("localdb/0.0.1/src/localdb",[],function(t,e,r){var i,n,o,s,l,u,a,f,c,h,p,d,y,g=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};s="ldb_",y=function(t){return function(e){return{}.toString.call(e)==="[object "+t.toLowerCase().replace(/\w/,function(t){return t.toUpperCase()})+"]"}},h=function(t,e){return y(e)(t)},f=y("object"),c=y("string"),l=y("array"),u=y("function"),a=y("number"),p=function(t){return null!=t&&c(t)?JSON.parse(t):[]},d=function(t){return null!=t&&l(t)?JSON.stringify(t):"[]"},o=function(t,e){var r,i,n,s,l,u;for(s in e){if(n=e[s],null==t[s])return!1;if(!f(n)){if(t[s]===n)continue;return!1}for(r in n)switch(i=n[r],r){case"$gt":if(t[s]<=i)return!1;break;case"$gte":if(t[s]<i)return!1;break;case"$lt":if(t[s]>=i)return!1;break;case"$lte":if(t[s]>i)return!1;break;case"$ne":if(t[s]===i)return!1;break;case"$in":if(l=t[s],g.call(i,l)<0)return!1;break;case"$nin":if(u=t[s],g.call(i,u)>=0)return!1;break;default:if(!o(t[s],JSON.parse('{"'+r+'": '+JSON.stringify(i)+"}")))return!1}}return!0},n=function(t,e){null==e&&(e=localStorage),this.ls=e,this.name=s+t},n.isSupport=function(){return"undefined"!=typeof localStorage&&null!==localStorage?!0:!1},n.prototype.collections=function(){var t,e,r,i;for(i=[],t=e=0,r=this.ls.length;r>=0?r>e:e>r;t=r>=0?++e:--e)0===this.ls.key(t).indexOf(""+this.name+"_")&&i.push(this.ls.key(t));return i},n.prototype.drop=function(t){var e,r,i,n,o;for(t=null!=t?"_"+t:"",i=function(){var r,i,n;for(n=[],e=r=0,i=this.ls.length;i>=0?i>r:r>i;e=i>=0?++r:--r)0===this.ls.key(e).indexOf(this.name+t)&&n.push(this.ls.key(e));return n}.call(this),n=0,o=i.length;o>n;n++)r=i[n],this.ls.removeItem(r);return!0},n.prototype.collection=function(t){return new i(t,this)},i=function(t,e){this.name=""+e.name+"_"+t,this.ls=e.ls,this.deserialize()},i.prototype.deserialize=function(){return this.data=p(this.ls.getItem(this.name))},i.prototype.serialize=function(){return this.ls.setItem(this.name,d(this.data))},i.prototype.drop=function(){return this.ls.removeItem(this.name)},i.prototype.insert=function(t){return this.deserialize(),this.data.push(t),this.serialize()},i.prototype.update=function(t,e){var r,i,n,s,l,u,a,f;for(i=null!=e.criteria?e.criteria:{},this.deserialize(),f=this.data,u=0,a=f.length;a>u;u++)if(n=f[u],o(n,i)){r=t.$set;for(s in r)l=r[s],n[s]=l}return this.serialize()},i.prototype.remove=function(t){var e,r;return null==t&&(t={}),e=null!=t.criteria?t.criteria:{},this.data=function(){var t,i,n,s;for(n=this.data,s=[],t=0,i=n.length;i>t;t++)r=n[t],o(r,e)||s.push(r);return s}.call(this),this.serialize()},i.prototype.find=function(t){var e,r,i,n,s,l,u,a,f,c,h,p,d,y;for(null==t&&(t={}),e=null!=t.criteria?t.criteria:{},u=null!=t.projection?t.projection:{},n=null!=t.limit?t.limit:-1,this.deserialize(),a=[],y=this.data,c=0,p=y.length;p>c;c++)if(r=y[c],o(r,e)){if(0===n)break;n-=1,a.push(r)}if("{}"===JSON.stringify(u))return a;for(l=[],h=0,d=a.length;d>h;h++){r=a[h],s={};for(i in u)f=u[i],1===f&&(s[i]=r[i]);l.push(s)}return l},i.prototype.findOne=function(t){return null==t&&(t={}),t.limit=1,this.find(t)},r.exports=n});