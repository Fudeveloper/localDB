define("localdb/0.0.1/src/localdb",[],function(t,e,r){var i,n,s,a,o,l,u,f,c,h,p,d,g,b,k=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};a="ldb_",b=function(t){return function(e){return{}.toString.call(e).toLowerCase()===("[object "+t+"]").toLowerCase()}},p=function(t,e){return b(e)(t)},f=b("object"),h=b("string"),o=b("array"),l=b("function"),u=b("number"),c=b("regexp"),d=function(t){return null!=t&&h(t)?JSON.parse(t):[]},g=function(t){return null!=t&&o(t)?JSON.stringify(t):"[]"},s=function(t,e){var r,i,n,a,o,l,f,d,g,b,y,m,$,v,z;for(f in e){if(a=e[f],h(a)||u(a)){if(null!=t[f]&&t[f]===a)continue;return!1}if(c(a)){if(a.test(t[f]))continue;return!1}switch(l=!0,f){case"$and":for(d=0,y=a.length;y>d;d++)if(r=a[d],!s(t,r))return!1;break;case"$not":if(s(t,a))return!1;break;case"$nor":for(g=0,m=a.length;m>g;g++)if(r=a[g],s(t,r))return!1;break;case"$or":for(o=!1,b=0,$=a.length;$>b;b++)if(r=a[b],s(t,r)){o=!0;break}if(!o)return!1;break;default:l=!1}if(!l)for(i in a)switch(n=a[i],i){case"$gt":if(t[f]<=n)return!1;break;case"$gte":if(t[f]<n)return!1;break;case"$lt":if(t[f]>=n)return!1;break;case"$lte":if(t[f]>n)return!1;break;case"$ne":if(t[f]===n)return!1;break;case"$in":if(v=t[f],k.call(n,v)<0)return!1;break;case"$nin":if(z=t[f],k.call(n,z)>=0)return!1;break;case"$exist":if(n!==(null!=t[f]))return!1;break;case"$type":if(!p(t[f],n))return!1;break;case"$mod":if(t[f]%n[0]!==n[1])return!1;break;case"$regex":if(!new RegExp(n).test(t[f]))return!1;break;default:if(!s(t[f],JSON.parse('{"'+i+'": '+JSON.stringify(n)+"}")))return!1}}return!0},n=function(t,e){null==e&&(e=localStorage),this.ls=e,this.name=a+t},n.isSupport=function(){return"undefined"!=typeof localStorage&&null!==localStorage?!0:!1},n.prototype.collections=function(){var t,e,r,i;for(i=[],t=e=0,r=this.ls.length;r>=0?r>e:e>r;t=r>=0?++e:--e)0===this.ls.key(t).indexOf(""+this.name+"_")&&i.push(this.ls.key(t));return i},n.prototype.drop=function(t){var e,r,i,n,s;for(t=null!=t?"_"+t:"",i=function(){var r,i,n;for(n=[],e=r=0,i=this.ls.length;i>=0?i>r:r>i;e=i>=0?++r:--r)0===this.ls.key(e).indexOf(this.name+t)&&n.push(this.ls.key(e));return n}.call(this),n=0,s=i.length;s>n;n++)r=i[n],this.ls.removeItem(r);return!0},n.prototype.collection=function(t){return new i(t,this)},i=function(t,e){this.name=""+e.name+"_"+t,this.ls=e.ls,this.deserialize()},i.prototype.deserialize=function(){return this.data=d(this.ls.getItem(this.name))},i.prototype.serialize=function(){return this.ls.setItem(this.name,g(this.data))},i.prototype.drop=function(){return this.ls.removeItem(this.name)},i.prototype.insert=function(t){return this.deserialize(),this.data.push(t),this.serialize()},i.prototype.update=function(t,e){var r,i,n,a,o,l,u,f;for(i=null!=e.criteria?e.criteria:{},this.deserialize(),f=this.data,l=0,u=f.length;u>l;l++)if(n=f[l],s(n,i)){r=t.$set;for(a in r)o=r[a],n[a]=o}return this.serialize()},i.prototype.remove=function(t){var e,r;return null==t&&(t={}),e=null!=t.criteria?t.criteria:{},this.deserialize(),this.data=function(){var t,i,n,a;for(n=this.data,a=[],t=0,i=n.length;i>t;t++)r=n[t],s(r,e)||a.push(r);return a}.call(this),this.serialize()},i.prototype.find=function(t){var e,r,i,n,a,o,l,u,f,c,h,p,d,g;for(null==t&&(t={}),e=null!=t.criteria?t.criteria:{},l=null!=t.projection?t.projection:{},n=null!=t.limit?t.limit:-1,this.deserialize(),u=[],g=this.data,c=0,p=g.length;p>c;c++)if(r=g[c],s(r,e)){if(0===n)break;n-=1,u.push(r)}if("{}"===JSON.stringify(l))return u;for(o=[],h=0,d=u.length;d>h;h++){r=u[h],a={};for(i in l)f=l[i],1===f&&(a[i]=r[i]);o.push(a)}return o},i.prototype.findOne=function(t){return null==t&&(t={}),t.limit=1,this.find(t)},r.exports=n});