define("localdb/0.0.1/src/localdb",[],function(r,e,t){"use strict";var i,n,s,c;s=r("localdb/0.0.1/src/lib/utils"),i=r("localdb/0.0.1/src/lib/collection"),c="ldb_",n=function(r,e){return null==e&&(e=localStorage),this.ls=e,this.name=c+r,this},n.isSupport=function(){return"undefined"!=typeof localStorage&&null!==localStorage?!0:!1},n.prototype.collections=function(){var r,e,t,i;for(i=[],r=e=0,t=this.ls.length;t>=0?t>e:e>t;r=t>=0?++e:--e)0===this.ls.key(r).indexOf(""+this.name+"_")&&i.push(this.ls.key(r));return i},n.prototype.collection=function(r){return new i(r,this)},n.prototype.drop=function(r){var e,t,i,n,s;for(r=null!=r?"_"+r:"",i=function(){var t,i,n;for(n=[],e=t=0,i=this.ls.length;i>=0?i>t:t>i;e=i>=0?++t:--t)0===this.ls.key(e).indexOf(this.name+r)&&n.push(this.ls.key(e));return n}.call(this),n=0,s=i.length;s>n;n++)t=i[n],this.ls.removeItem(t);return!0},t.exports=n}),define("localdb/0.0.1/src/lib/utils",[],function(r,e,t){var i,n;i={},n=function(r){return function(e){return{}.toString.call(e).toLowerCase()===("[object "+r+"]").toLowerCase()}},i.isType=function(r,e){return n(e)(r)},i.isObject=n("object"),i.isString=n("string"),i.isNumber=n("number"),i.isArray=n("array"),i.isFunction=n("function"),i.isRegex=n("regexp"),i.parse=function(r){return null!=r&&i.isString(r)?JSON.parse(r):[]},i.stringify=function(r){return null!=r&&(i.isArray(r)||i.isObject(r))?JSON.stringify(r):"[]"},t.exports=i}),define("localdb/0.0.1/src/lib/collection",[],function(r,e,t){"use strict";var i,n,s,c,l;l=r("localdb/0.0.1/src/lib/utils"),n=r("localdb/0.0.1/src/lib/criteria"),s=r("localdb/0.0.1/src/lib/projection"),c=r("localdb/0.0.1/src/lib/update"),i=function(r,e){this.name=""+e.name+"_"+r,this.ls=e.ls,this.deserialize()},i.prototype.deserialize=function(){return this.data=l.parse(this.ls.getItem(this.name))},i.prototype.serialize=function(){return this.ls.setItem(this.name,l.stringify(this.data))},i.prototype.drop=function(){return this.ls.removeItem(this.name)},i.prototype.insert=function(r){return this.deserialize(),this.data.push(r),this.serialize()},i.prototype.update=function(r,e){var t;return null==e&&(e={}),t=null!=e.criteria?e.criteria:{},this.deserialize(),this.data=c(this.data,r,t),this.serialize()},i.prototype.remove=function(r){var e,t;return null==r&&(r={}),e=null!=r.criteria?r.criteria:{},this.deserialize(),this.data=function(){var r,i,s,c;for(s=this.data,c=[],r=0,i=s.length;i>r;r++)t=s[r],n.check(t,e)||c.push(t);return c}.call(this),this.serialize()},i.prototype.find=function(r){var e,t,i,c,l,a,u,o;for(null==r&&(r={}),e=null!=r.criteria?r.criteria:{},c=null!=r.projection?r.projection:{},i=null!=r.limit?r.limit:-1,this.deserialize(),l=[],o=this.data,a=0,u=o.length;u>a;a++)if(t=o[a],n.check(t,e)){if(0===i)break;i-=1,l.push(t)}return s.generate(l,c)},i.prototype.findOne=function(r){return null==r&&(r={}),r.limit=1,this.find(r)},t.exports=i}),define("localdb/0.0.1/src/lib/criteria",[],function(r,e,t){"use strict";var i,n,s,c,l,a,u,o,f,h=[].indexOf||function(r){for(var e=0,t=this.length;t>e;e++)if(e in this&&this[e]===r)return e;return-1};n=r("localdb/0.0.1/src/lib/utils"),l=function(r,e,t){return i.check(r[e.split(".")[0]],new function(){return this[e.substr(e.indexOf(".")+1)]=t})},u=function(r,e){return n.isNumber(r)&&r===e?!0:n.isArray(r)&&h.call(r,e)>=0?!0:!1},f=function(r,e){return n.isString(r)&&r===e?!0:n.isArray(r)&&h.call(r,e)>=0?!0:!1},o=function(r,e){var t,i,s;if(n.isString(r)&&e.test(r))return!0;if(n.isArray(r))for(i=0,s=r.length;s>i;i++)if(t=r[i],e.test(t))return!0;return!1},a=function(r,e,t){var n,s,c,l,a,u,o;for(s in t)if(c=t[s],"$not"===s)return i.check(r,new function(){return this[e]=c})?!1:!0;switch(e){case"$and":for(l=0,u=t.length;u>l;l++)if(n=t[l],!i.check(r,n))return!1;break;case"$nor":for(a=0,o=t.length;o>a;a++)if(n=t[a],i.check(r,n))return!1;break;case"$or":if(!function(){var e,s;for(e=0,s=t.length;s>e;e++)if(n=t[e],i.check(r,n))return!0}())return!1;break;default:return void 0}return!0},s=function(r,e,t){var c,l,a;switch(e){case"$all":if(!n.isArray(r))return!1;for(l=0,a=t.length;a>l;l++)if(c=t[l],!function(){var t,i,l;for(i=0,l=r.length;l>i;i++)if(t=r[i],n.isArray(c)?s(t,e,c):t===c)return!0}())return!1;break;case"$elemMatch":if(!n.isArray(r))return!1;if(!function(){var e,n,s;for(n=0,s=r.length;s>n;n++)if(e=r[n],i.check(e,t))return!0}())return!1;break;case"$size":if(!n.isArray(r))return!1;if(r.length!==t)return!1;break;default:return void 0}return!0},c=function(r,e,t){var s,c,l,a,u,o,f;for(s in t)switch(l=t[s],s){case"$gt":if(r[e]<=l)return!1;break;case"$gte":if(r[e]<l)return!1;break;case"$lt":if(r[e]>=l)return!1;break;case"$lte":if(r[e]>l)return!1;break;case"$ne":if(r[e]===l)return!1;break;case"$in":for(a=!0,u=0,o=l.length;o>u;u++){if(c=l[u],n.isRegex(c)&&c.test(r[e])){a=!1;break}if(r[e]===c){a=!1;break}}if(a)return!1;break;case"$nin":if(f=r[e],h.call(l,f)>=0)return!1;break;case"$exists":if(l!==(null!=r[e]))return!1;break;case"$type":if(!n.isType(r[e],l))return!1;break;case"$mod":if(r[e]%l[0]!==l[1])return!1;break;case"$regex":if(!new RegExp(l).test(r[e]))return!1;break;default:if(!i.check(r[e],JSON.parse('{"'+s+'": '+JSON.stringify(l)+"}")))return!1}return!0},i={},i.check=function(r,e){var t,i,h,b;for(h in e){if(i=e[h],-1!==h.indexOf(".")){if(l(r,h,i))continue;return!1}if(n.isNumber(i)&&"$size"!==h){if(u(r[h],i))continue;return!1}if(n.isString(i)){if(f(r[h],i))continue;return!1}if(n.isRegex(i)){if(o(r[h],i))continue;return!1}if(b=a(r,h,i),null!=b){if(b)continue;return!1}if(t=s(r,h,i),null!=t){if(t)continue;return!1}if(!c(r,h,i))return!1}return!0},t.exports=i}),define("localdb/0.0.1/src/lib/projection",[],function(r,e,t){"use strict";var i,n,s,c;s=r("localdb/0.0.1/src/lib/utils"),i=r("localdb/0.0.1/src/lib/criteria"),n={},n.generate=function(r,e){var t;return"{}"===JSON.stringify(e)?r:function(){var i,n,s;for(s=[],i=0,n=r.length;n>i;i++)t=r[i],s.push(c(t,e));return s}()},c=function(r,e){var t,i,n,l,a,u,o,f,h,b;a={};for(n in e)if(f=e[n],-1!==n.indexOf(".$")){if(n=n.split(".")[0],!s.isArray(r[n])||0===r[n].length)continue;a[n]=[r[n][0]]}else{if(0===n.indexOf("$elemMatch")){if(!s.isArray(r)||0===r.length)continue;for(l=[],h=0,b=r.length;b>h;h++){i=r[h],t=!0;for(u in f)o=f[u],s.isObject(o)?console.log("TODO"):i[u]!==o&&(t=!1);t&&l.push(i)}return l}s.isObject(f)?a[n]=c(r[n],f):1===f&&(a[n]=r[n])}return a},t.exports=n}),define("localdb/0.0.1/src/lib/update",[],function(r,e,t){"use strict";var i,n,s,c;i=r("localdb/0.0.1/src/lib/criteria"),s=r("localdb/0.0.1/src/lib/utils"),c=function(r,e,t,n){var c,l,a,u,o,f,h,b,d,p,g,k,y,m,v,$,x,O,S;switch(e){case"$inc":for(l in t)for(a=t[l],u=0,b=r.length;b>u;u++)c=r[u],i.check(c,n)&&s.isNumber(c[l])&&(c[l]=c[l]+a);break;case"$set":for(l in t)for(a=t[l],o=0,d=r.length;d>o;o++)c=r[o],i.check(c,n)&&null!=c[l]&&(c[l]=a);break;case"$mul":for(l in t)for(a=t[l],f=0,p=r.length;p>f;f++)c=r[f],i.check(c,n)&&s.isNumber(c[l])&&(c[l]=c[l]*a);break;case"$rename":for(l in t)for(a=t[l],h=0,g=r.length;g>h;h++)c=r[h],i.check(c,n)&&null!=c[l]&&(c[a]=c[l],delete c[l]);break;case"$unset":for(l in t)for($=0,k=r.length;k>$;$++)c=r[$],i.check(c,n)&&null!=c[l]&&delete c[l];break;case"$min":for(l in t)for(a=t[l],x=0,y=r.length;y>x;x++)c=r[x],i.check(c,n)&&s.isNumber(c[l])&&(c[l]=Math.min(c[l],a));break;case"$max":for(l in t)for(a=t[l],O=0,m=r.length;m>O;O++)c=r[O],i.check(c,n)&&s.isNumber(c[l])&&(c[l]=Math.max(c[l],a));break;default:for(S=0,v=r.length;v>S;S++)c=r[S],i.check(c,n)&&null!=c[e]&&(c[e]=t)}return r},n=function(r,e,t){var i,n;for(i in e)n=e[i],r=c(r,i,n,t);return r},t.exports=n});