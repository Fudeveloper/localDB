define("localdb/0.0.1/src/localdb",[],function(t,e,r){"use strict";var n,i,o,f;o=t("localdb/0.0.1/src/lib/utils"),n=t("localdb/0.0.1/src/lib/collection"),f="ldb_",i=function(){function t(t,e){this.ls=null!=e?e:localStorage,this.name=f+t}return t.prototype.collections=function(){var t,e,r,n;for(n=[],t=e=0,r=this.ls.length;r>=0?r>e:e>r;t=r>=0?++e:--e)0===this.ls.key(t).indexOf(""+this.name+"_")&&n.push(this.ls.key(t));return n},t.prototype.collection=function(t){return new n(t,this)},t.prototype.drop=function(t){var e,r,n,i,o;for(t=null!=t?"_"+t:"",n=function(){var r,n,i;for(i=[],e=r=0,n=this.ls.length;n>=0?n>r:r>n;e=n>=0?++r:--r)0===this.ls.key(e).indexOf(this.name+t)&&i.push(this.ls.key(e));return i}.call(this),i=0,o=n.length;o>i;i++)r=n[i],this.ls.removeItem(r);return!0},t}(),i.isSupport=function(){return"undefined"!=typeof localStorage&&null!==localStorage?!0:!1},r.exports=i}),define("localdb/0.0.1/src/lib/utils",[],function(t,e,r){"use strict";var n,i,o,f,u;n=t("localdb/0.0.1/src/lib/bson")(),i={},f=Object.prototype.toString,u=function(t){return function(e){return f.call(e).toLowerCase()===("[object "+t+"]").toLowerCase()}},i.isType=function(t,e){return u(e)(t)},i.isObject=u("object"),i.isString=u("string"),i.isNumber=u("number"),i.isArray=u("array"),i.isFunction=u("function"),i.isRegex=u("regexp"),i.isSameType=function(t,e){return f.call(t)===f.call(e)},i.keys=function(t){var e;return i.isObject(t)?Object.keys?Object.keys(t):function(){var r;r=[];for(e in t)i.has(t,e)&&r.push(e);return r}():[]},i.has=function(t,e){return null!==t&&void 0!==t&&Object.prototype.hasOwnProperty.call(t,e)},o=function(t,e,r,n){var u,s,a,h,c,l,p,_,g;if(t===e)return 0!==t||1/t===1/e;if(null===t&&void 0===e)return!1;if(void 0===t&&null===e)return!1;if(h=f.call(t),h!==f.call(e))return!1;switch(h){case"[object RegExp]":return""+t==""+e;case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":return+t===+e;case"[object Boolean]":return+t===+e}if(s="[object Array]"===h,!s){if("object"!=typeof t||"object"!=typeof e)return!1;if(u=t.constructor,a=e.constructor,u!==a&&!(i.isFunction(u)&&u instanceof u&&i.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}for(p=r.length;p--;)if(r[p]===t)return n[p]===e;if(r.push(t),n.push(e),s){if(g=t.length,_=g===e.length)for(;g--&&(_=o(t[g],e[g],r,n)););}else if(l=i.keys(t),g=l.length,_=i.keys(e)===g)for(;g--&&(c=l[g],_=i.has(e,c)&&o(t[c],e[c],r,n)););return r.pop(),n.pop(),_},i.isEqual=function(t,e){return o(t,e,[],[])},i.createObjectId=function(){return n.ObjectID().inspect()},i.parse=function(t){return null!=t&&i.isString(t)?JSON.parse(t):[]},i.stringify=function(t){return null!=t&&(i.isArray(t)||i.isObject(t))?JSON.stringify(t):"[]"},r.exports=i}),define("localdb/0.0.1/src/lib/bson",[],function(require,exports,module){var bson=function(){function t(){return a()}function e(){return r(Array.prototype.join.call(arguments,"/"))}function r(t){for(var e,r,n=[],i=t.split("/"),o=0,f=i.length-1;f>=o;o++)e=i[o],("."!==e||void 0===r)&&(".."===e&&n.length&&".."!==r&&"."!==r&&void 0!==r?(n.pop(),r=n.slice(-1)[0]):("."===r&&n.pop(),n.push(e),r=e));return n.join("/")}function n(t){return t&&t.substr(0,t.lastIndexOf("/"))||"."}function i(t,r){for(var i,o,f=e(n(t.id),/\.\/$/.test(r)?r+"index":r).replace(/\.js$/,""),u=e(f,"index"),s=t.pkg,a=s.modules.length;a-->0;)if(o=s.modules[a].id,o==f||o==u){i=s.modules[a];break}return i}function o(t){function e(r){var n,o;if(/^\./.test(r))n=i(t,r);else{if(s&&s.hasOwnProperty(r))return s[r];if(aliases&&aliases.hasOwnProperty(r))return e(aliases[r]);if(o=h[r],!o&&l){try{o=l(r)}catch(f){}if(o)return o}if(!o)throw new Error('Cannot find module "'+r+'" @[module: '+t.id+" package: "+t.pkg.name+"]");n=o.index}if(!n)throw new Error('Cannot find module "'+r+'" @[module: '+t.id+" package: "+t.pkg.name+"]");return n.parent=t,n.call()}return e}function f(t,e,r){var n={pkg:t,id:e,wrapper:r},i=!1;n.exports={},n.requireAMD=o(n),n.call=function(){return i?n.exports:(i=!0,c.requireAMD=n.requireAMD,n.wrapper(n,n.exports,c,c.requireAMD),n.exports)},t.mainModuleId==n.id&&(t.index=n,0===t.parents.length&&(a=n.call)),t.modules.push(n)}function u(){var t=arguments[arguments.length-1],e=Array.prototype.slice.call(arguments,0,arguments.length-1),r=t(e);return h[r.name]=r,1==arguments.length&&(h.main=r),function(t){var e;for(e in t)f(r,e,t[e])}}var s,a,h={},c={},l="undefined"!=typeof requireAMD&&requireAMD;return t.main=t,t.module=f,t.packages=h,t.pkg=u,t.requireAMD=function(t){return h.main.index.requireAMD(t)},s={},aliases={},t}(this);bson.pkg(function(t){return{name:"bson",mainModuleId:"bson",modules:[],parents:t}})({binary:function(t,e,r,n){function i(t,e){if(!(this instanceof i))return new i(t,e);if(this._bsontype="Binary",t instanceof Number?(this.sub_type=t,this.position=0):(this.sub_type=null==e?f:e,this.position=0),null==t||t instanceof Number)this.buffer="undefined"!=typeof o?new o(i.BUFFER_SIZE):"undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(i.BUFFER_SIZE)):new Array(i.BUFFER_SIZE),this.position=0;else{if("string"==typeof t)if("undefined"!=typeof o)this.buffer=new o(t);else{if("undefined"==typeof Uint8Array&&"[object Array]"!=Object.prototype.toString.call(t))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=u(t)}else this.buffer=t;this.position=t.length}}if("undefined"==typeof window)var o=n("buffer").Buffer;var f=0,u=function(t){for(var e="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t.length)):new Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e},s=function(t,e,r){for(var n="",i=e;r>i;i++)n+=String.fromCharCode(t[i]);return n};i.prototype.put=function(t){if(null!=t.length&&"number"!=typeof t&&1!=t.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof t&&0>t||t>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var e=null;if(e="string"==typeof t?t.charCodeAt(0):null!=t.length?t[0]:t,this.buffer.length>this.position)this.buffer[this.position++]=e;else if("undefined"!=typeof o&&o.isBuffer(this.buffer)){var r=new o(i.BUFFER_SIZE+this.buffer.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r,this.buffer[this.position++]=e}else{var r=null;r="[object Uint8Array]"==Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(i.BUFFER_SIZE+this.buffer.length)):new Array(i.BUFFER_SIZE+this.buffer.length);for(var n=0;n<this.buffer.length;n++)r[n]=this.buffer[n];this.buffer=r,this.buffer[this.position++]=e}},i.prototype.write=function(t,e){if(e="number"==typeof e?e:this.position,this.buffer.length<e+t.length){var r=null;if("undefined"!=typeof o&&o.isBuffer(this.buffer))r=new o(this.buffer.length+t.length),this.buffer.copy(r,0,0,this.buffer.length);else if("[object Uint8Array]"==Object.prototype.toString.call(this.buffer)){r=new Uint8Array(new ArrayBuffer(this.buffer.length+t.length));for(var n=0;n<this.position;n++)r[n]=this.buffer[n]}this.buffer=r}if("undefined"!=typeof o&&o.isBuffer(t)&&o.isBuffer(this.buffer))t.copy(this.buffer,e,0,t.length),this.position=e+t.length>this.position?e+t.length:this.position;else if("undefined"!=typeof o&&"string"==typeof t&&o.isBuffer(this.buffer))this.buffer.write(t,"binary",e),this.position=e+t.length>this.position?e+t.length:this.position;else if("[object Uint8Array]"==Object.prototype.toString.call(t)||"[object Array]"==Object.prototype.toString.call(t)&&"string"!=typeof t){for(var n=0;n<t.length;n++)this.buffer[e++]=t[n];this.position=e>this.position?e:this.position}else if("string"==typeof t){for(var n=0;n<t.length;n++)this.buffer[e++]=t.charCodeAt(n);this.position=e>this.position?e:this.position}},i.prototype.read=function(t,e){if(e=e&&e>0?e:this.position,this.buffer.slice)return this.buffer.slice(t,t+e);for(var r="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e)):new Array(e),n=0;e>n;n++)r[n]=this.buffer[t++];return r},i.prototype.value=function(t){if(t=null==t?!1:t,"undefined"!=typeof o&&o.isBuffer(this.buffer))return t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(t){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var e="[object Uint8Array]"==Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),r=0;r<this.position;r++)e[r]=this.buffer[r];return e}return s(this.buffer,0,this.position)},i.prototype.length=function(){return this.position},i.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},i.prototype.toString=function(t){return null!=this.buffer?this.buffer.slice(0,this.position).toString(t):""},i.BUFFER_SIZE=256,i.SUBTYPE_DEFAULT=0,i.SUBTYPE_FUNCTION=1,i.SUBTYPE_BYTE_ARRAY=2,i.SUBTYPE_UUID_OLD=3,i.SUBTYPE_UUID=4,i.SUBTYPE_MD5=5,i.SUBTYPE_USER_DEFINED=128,e.Binary=i},binary_parser:function(t,e,n,i){function o(t,e){return this instanceof o?(this.bigEndian=t,void(this.allowExceptions=e)):new o(t,e)}function f(t,e){this.bigEndian=t||0,this.buffer=[],this.setBuffer(e)}for(var u=String.fromCharCode,s=[],a=0;64>a;a++)s[a]=Math.pow(2,a);o.warn=function(t){if(this.allowExceptions)throw new Error(t);return 1},o.decodeFloat=function(t,e,r){var n=new this.Buffer(this.bigEndian,t);n.checkBuffer(e+r+1);var i=s[r-1]-1,o=n.readBits(e+r,1),f=n.readBits(e,r),u=0,a=2,h=n.buffer.length+(-e>>3)-1;do for(var c=n.buffer[++h],l=e%8||8,p=1<<l;p>>=1;c&p&&(u+=1/a),a*=2);while(e-=l);return f==(i<<1)+1?u?0/0:o?-1/0:+1/0:(1+-2*o)*(f||u?f?Math.pow(2,f-i)*(1+u):Math.pow(2,-i+1)*u:0)},o.decodeInt=function(t,e,r,n){var i=new this.Buffer(this.bigEndian||n,t),o=i.readBits(0,e),f=s[e];return r&&o>=f/2?o-f:o},o.encodeFloat=function(t,e,n){var i,o,f,u,a,h=s[n-1]-1,c=-h+1,l=h,p=c-e,_=parseFloat(t),g=isNaN(_)||_==-1/0||_==+1/0?_:0,y=0,b=2*h+1+e+3,d=new Array(b),B=(_=0!==g?0:_)<0,O=Math.floor(_=Math.abs(_)),N=_-O;for(u=b;u;d[--u]=0);for(u=h+2;O&&u;d[--u]=O%2,O=Math.floor(O/2));for(u=h+1;N>0&&u;(d[++u]=((N*=2)>=1)-0)&&--N);for(u=-1;++u<b&&!d[u];);if(d[(i=e-1+(u=(y=h+1-u)>=c&&l>=y?u+1:h+1-(y=c-1)))+1]){if(!(o=d[i]))for(a=i+2;!o&&b>a;o=d[a++]);for(a=i+1;o&&--a>=0;(d[a]=!d[a]-0)&&(o=0));}for(u=0>u-2?-1:u-3;++u<b&&!d[u];);for((y=h+1-u)>=c&&l>=y?++u:c>y&&(y!=h+1-b&&p>y&&this.warn("encodeFloat::float underflow"),u=h+1-(y=c-1)),(O||0!==g)&&(this.warn(O?"encodeFloat::float overflow":"encodeFloat::"+g),y=l+1,u=h+2,g==-1/0?B=1:isNaN(g)&&(d[u]=1)),_=Math.abs(y+h),a=n+1,f="";--a;f=_%2+f,_=_>>=1);for(_=0,a=0,u=(f=(B?"1":"0")+f+d.slice(u,u+e).join("")).length,r=[];u;a=(a+1)%8)_+=(1<<a)*f.charAt(--u),7==a&&(r[r.length]=String.fromCharCode(_),_=0);return r[r.length]=_?String.fromCharCode(_):"",(this.bigEndian?r.reverse():r).join("")},o.encodeInt=function(t,e,r,n){var i=s[e];(t>=i||-(i/2)>t)&&(this.warn("encodeInt::overflow"),t=0),0>t&&(t+=i);for(var o=[];t;o[o.length]=String.fromCharCode(t%256),t=Math.floor(t/256));for(e=-(-e>>3)-o.length;e--;o[o.length]="\x00");return(this.bigEndian||n?o.reverse():o).join("")},o.toSmall=function(t){return this.decodeInt(t,8,!0)},o.fromSmall=function(t){return this.encodeInt(t,8,!0)},o.toByte=function(t){return this.decodeInt(t,8,!1)},o.fromByte=function(t){return this.encodeInt(t,8,!1)},o.toShort=function(t){return this.decodeInt(t,16,!0)},o.fromShort=function(t){return this.encodeInt(t,16,!0)},o.toWord=function(t){return this.decodeInt(t,16,!1)},o.fromWord=function(t){return this.encodeInt(t,16,!1)},o.toInt=function(t){return this.decodeInt(t,32,!0)},o.fromInt=function(t){return this.encodeInt(t,32,!0)},o.toLong=function(t){return this.decodeInt(t,64,!0)},o.fromLong=function(t){return this.encodeInt(t,64,!0)},o.toDWord=function(t){return this.decodeInt(t,32,!1)},o.fromDWord=function(t){return this.encodeInt(t,32,!1)},o.toQWord=function(t){return this.decodeInt(t,64,!0)},o.fromQWord=function(t){return this.encodeInt(t,64,!0)},o.toFloat=function(t){return this.decodeFloat(t,23,8)},o.fromFloat=function(t){return this.encodeFloat(t,23,8)},o.toDouble=function(t){return this.decodeFloat(t,52,11)},o.fromDouble=function(t){return this.encodeFloat(t,52,11)},o.encode_int32=function(t,e){var r,n,i,o,f;return f=0>t?t+4294967296:t,r=Math.floor(f/16777215),f&=16777215,n=Math.floor(f/65535),f&=65535,i=Math.floor(f/255),f&=255,o=Math.floor(f),e?[u(r),u(n),u(i),u(o)]:u(r)+u(n)+u(i)+u(o)},o.encode_int64=function(t){var e,r,n,i,o,f,s,a,h;return h=0>t?t+0x10000000000000000:t,e=Math.floor(h/72057594037927940),h&=72057594037927940,r=Math.floor(h/0xffffffffffff),h&=0xffffffffffff,n=Math.floor(h/0xffffffffff),h&=0xffffffffff,i=Math.floor(h/4294967295),h&=4294967295,o=Math.floor(h/16777215),h&=16777215,f=Math.floor(h/65535),h&=65535,s=Math.floor(h/255),h&=255,a=Math.floor(h),u(e)+u(r)+u(n)+u(i)+u(o)+u(f)+u(s)+u(a)},o.decode_utf8=function(t){for(var e,r=t.length,n="",i=0,o=0,f=0;r>i;)o=t.charCodeAt(i),128>o?(n+=String.fromCharCode(o),i++):o>191&&224>o?(f=t.charCodeAt(i+1),n+=String.fromCharCode((31&o)<<6|63&f),i+=2):(f=t.charCodeAt(i+1),e=t.charCodeAt(i+2),n+=String.fromCharCode((15&o)<<12|(63&f)<<6|63&e),i+=3);return n},o.encode_cstring=function(t){return unescape(encodeURIComponent(t))+o.fromByte(0)},o.encode_utf8=function(t){for(var e,r="",n=0,i=t.length;i>n;n++)e=t.charCodeAt(n),128>e?r+=String.fromCharCode(e):e>127&&2048>e?(r+=String.fromCharCode(e>>6|192),r+=String.fromCharCode(63&e|128)):(r+=String.fromCharCode(e>>12|224),r+=String.fromCharCode(e>>6&63|128),r+=String.fromCharCode(63&e|128));return r},o.hprint=function(t){for(var e,r=0,n=t.length;n>r;r++)t.charCodeAt(r)<32?(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),process.stdout.write(e+" ")):(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),process.stdout.write(e+" "));process.stdout.write("\n\n")},o.ilprint=function(t){for(var e,r=0,n=t.length;n>r;r++)t.charCodeAt(r)<32?(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(10):t.charCodeAt(r).toString(10),i("util").debug(e+" : ")):(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(10):t.charCodeAt(r).toString(10),i("util").debug(e+" : "+t.charAt(r)))},o.hlprint=function(t){for(var e,r=0,n=t.length;n>r;r++)t.charCodeAt(r)<32?(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),i("util").debug(e+" : ")):(e=t.charCodeAt(r)<=15?"0"+t.charCodeAt(r).toString(16):t.charCodeAt(r).toString(16),i("util").debug(e+" : "+t.charAt(r)))},f.prototype.setBuffer=function(t){var e,r,n;if(t){for(r=e=t.length,n=this.buffer=new Array(e);r;n[e-r]=t.charCodeAt(--r));this.bigEndian&&n.reverse()}},f.prototype.hasNeededBits=function(t){return this.buffer.length>=-(-t>>3)},f.prototype.checkBuffer=function(t){if(!this.hasNeededBits(t))throw new Error("checkBuffer::missing bytes")},f.prototype.readBits=function(t,e){function r(t,e){for(;e--;t=1073741824==(1073741824&(t%=2147483648))?2*t:2*(t-1073741824)+2147483647+1);return t}if(0>t||0>=e)return 0;this.checkBuffer(t+e);for(var n,i=t%8,o=this.buffer.length-(t>>3)-1,f=this.buffer.length+(-(t+e)>>3),u=o-f,s=(this.buffer[o]>>i&(1<<(u?8-i:e))-1)+(u&&(n=(t+e)%8)?(this.buffer[f++]&(1<<n)-1)<<(u--<<3)-i:0);u;s+=r(this.buffer[f++],(u--<<3)-i));return s},o.Buffer=f,e.BinaryParser=o},bson:function(module,exports,global,requireAMD,undefined){function BSON(){}function calculateElement(t,e,r){var n="undefined"!=typeof Buffer;switch(typeof e){case"string":return 1+(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1+4+(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1;case"number":return Math.floor(e)===e&&e>=BSON.JS_INT_MIN&&e<=BSON.JS_INT_MAX&&e>=BSON.BSON_INT32_MIN&&e<=BSON.BSON_INT32_MAX?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+5:(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+9;case"undefined":return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1;case"boolean":return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+2;case"object":if(null==e||e instanceof MinKey||e instanceof MaxKey||"MinKey"==e._bsontype||"MaxKey"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1;if(e instanceof ObjectID||"ObjectID"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+13;if(e instanceof Date||isDate(e))return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+6+e.length;if(e instanceof Long||e instanceof Double||e instanceof Timestamp||"Long"==e._bsontype||"Double"==e._bsontype||"Timestamp"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+9;if(e instanceof Code||"Code"==e._bsontype)return null!=e.scope&&Object.keys(e.scope).length>0?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+4+(n?Buffer.byteLength(e.code.toString(),"utf8"):numberOfBytes(e.code.toString()))+1+BSON.calculateObjectSize(e.scope,r):(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+(n?Buffer.byteLength(e.code.toString(),"utf8"):numberOfBytes(e.code.toString()))+1;if(e instanceof Binary||"Binary"==e._bsontype)return e.sub_type==Binary.SUBTYPE_BYTE_ARRAY?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+(e.position+1+4+1+4):(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+(e.position+1+4+1);if(e instanceof Symbol||"Symbol"==e._bsontype)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+((n?Buffer.byteLength(e.value,"utf8"):numberOfBytes(e.value))+4+1+1);if(e instanceof DBRef||"DBRef"==e._bsontype){var i={$ref:e.namespace,$id:e.oid};return null!=e.db&&(i.$db=e.db),(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+BSON.calculateObjectSize(i,r)}return e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)?(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+(n?Buffer.byteLength(e.source,"utf8"):numberOfBytes(e.source))+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1:(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+BSON.calculateObjectSize(e,r)+1;case"function":if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)||"[object RegExp]"==String.call(e))return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+(n?Buffer.byteLength(e.source,"utf8"):numberOfBytes(e.source))+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1;if(r&&null!=e.scope&&Object.keys(e.scope).length>0)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+4+(n?Buffer.byteLength(e.toString(),"utf8"):numberOfBytes(e.toString()))+1+BSON.calculateObjectSize(e.scope,r);if(r)return(null!=t?(n?Buffer.byteLength(t,"utf8"):numberOfBytes(t))+1:0)+1+4+(n?Buffer.byteLength(e.toString(),"utf8"):numberOfBytes(e.toString()))+1}return 0}var Long=requireAMD("./long").Long,Double=requireAMD("./double").Double,Timestamp=requireAMD("./timestamp").Timestamp,ObjectID=requireAMD("./objectid").ObjectID,Symbol=requireAMD("./symbol").Symbol,Code=requireAMD("./code").Code,MinKey=requireAMD("./min_key").MinKey,MaxKey=requireAMD("./max_key").MaxKey,DBRef=requireAMD("./db_ref").DBRef,Binary=requireAMD("./binary").Binary,BinaryParser=requireAMD("./binary_parser").BinaryParser,writeIEEE754=requireAMD("./float_parser").writeIEEE754,readIEEE754=requireAMD("./float_parser").readIEEE754,isDate=function(t){return"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)};BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.calculateObjectSize=function(t,e){var r=5;if(Array.isArray(t))for(var n=0;n<t.length;n++)r+=calculateElement(n.toString(),t[n],e);else{t.toBSON&&(t=t.toBSON());for(var i in t)r+=calculateElement(i,t[i],e)}return r},BSON.serializeWithBufferAndIndex=function(t,e,r,n,i){i=null==i?!1:i;var o=r.length;return r[n++]=255&o,r[n++]=o>>8&255,r[n++]=o>>16&255,r[n++]=o>>24&255,serializeObject(t,e,r,n,i)-1};var serializeObject=function(t,e,r,n,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)n=packElement(o.toString(),t[o],e,r,n,i);else{t.toBSON&&(t=t.toBSON());for(var f in t)"$db"!=f&&"$ref"!=f&&"$id"!=f&&BSON.checkKey(f,!e),n=packElement(f,t[f],e,r,n,i)}return r[n++]=0,n},stringToBytes=function(t){for(var e,r,n=[],i=0;i<t.length;i++){e=t.charCodeAt(i),r=[];do r.push(255&e),e>>=8;while(e);n=n.concat(r.reverse())}return n},numberOfBytes=function(t){for(var e,r,n=0,i=0;i<t.length;i++){e=t.charCodeAt(i),r=[];do r.push(255&e),e>>=8;while(e);n+=r.length}return n},writeToTypedArray=function(t,e,r){for(var n=stringToBytes(e),i=0;i<n.length;i++)t[r+i]=n[i];return n.length},supportsBuffer="undefined"!=typeof Buffer,packElement=function(t,e,r,n,i,o){switch(typeof e){case"string":n[i++]=BSON.BSON_DATA_STRING;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var u=supportsBuffer?Buffer.byteLength(e)+1:numberOfBytes(e)+1;return n[i+3]=u>>24&255,n[i+2]=u>>16&255,n[i+1]=u>>8&255,n[i]=255&u,i+=4,supportsBuffer?n.write(e,i,"utf8"):writeToTypedArray(n,e,i),i=i+u-1,n[i++]=0,i;case"number":if(Math.floor(e)===e&&e>=BSON.JS_INT_MIN&&e<=BSON.JS_INT_MAX)if(e>=BSON.BSON_INT32_MIN&&e<=BSON.BSON_INT32_MAX){n[i++]=BSON.BSON_DATA_INT;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0,n[i++]=255&e,n[i++]=e>>8&255,n[i++]=e>>16&255,n[i++]=e>>24&255}else if(e>=BSON.JS_INT_MIN&&e<=BSON.JS_INT_MAX){n[i++]=BSON.BSON_DATA_NUMBER;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0,writeIEEE754(n,e,i,"little",52,8),i+=8}else{n[i++]=BSON.BSON_DATA_LONG;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var s=Long.fromNumber(e),a=s.getLowBits(),h=s.getHighBits();n[i++]=255&a,n[i++]=a>>8&255,n[i++]=a>>16&255,n[i++]=a>>24&255,n[i++]=255&h,n[i++]=h>>8&255,n[i++]=h>>16&255,n[i++]=h>>24&255}else{n[i++]=BSON.BSON_DATA_NUMBER;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0,writeIEEE754(n,e,i,"little",52,8),i+=8}return i;case"undefined":n[i++]=BSON.BSON_DATA_NULL;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,i;case"boolean":n[i++]=BSON.BSON_DATA_BOOLEAN;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,n[i++]=e?1:0,i;case"object":if(null===e||e instanceof MinKey||e instanceof MaxKey||"MinKey"==e._bsontype||"MaxKey"==e._bsontype){n[i++]=null===e?BSON.BSON_DATA_NULL:e instanceof MinKey?BSON.BSON_DATA_MIN_KEY:BSON.BSON_DATA_MAX_KEY;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,i}if(e instanceof ObjectID||"ObjectID"==e._bsontype){n[i++]=BSON.BSON_DATA_OID;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,supportsBuffer?n.write(e.id,i,"binary"):writeToTypedArray(n,e.id,i),i+=12}if(e instanceof Date||isDate(e)){n[i++]=BSON.BSON_DATA_DATE;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var c=Long.fromNumber(e.getTime()),a=c.getLowBits(),h=c.getHighBits();return n[i++]=255&a,n[i++]=a>>8&255,n[i++]=a>>16&255,n[i++]=a>>24&255,n[i++]=255&h,n[i++]=h>>8&255,n[i++]=h>>16&255,n[i++]=h>>24&255,i}if("undefined"!=typeof Buffer&&Buffer.isBuffer(e)){n[i++]=BSON.BSON_DATA_BINARY;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var u=e.length;return n[i++]=255&u,n[i++]=u>>8&255,n[i++]=u>>16&255,n[i++]=u>>24&255,n[i++]=BSON.BSON_BINARY_SUBTYPE_DEFAULT,e.copy(n,i,0,u),i+=u}if(e instanceof Long||e instanceof Timestamp||"Long"==e._bsontype||"Timestamp"==e._bsontype){n[i++]=e instanceof Long?BSON.BSON_DATA_LONG:BSON.BSON_DATA_TIMESTAMP;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var a=e.getLowBits(),h=e.getHighBits();return n[i++]=255&a,n[i++]=a>>8&255,n[i++]=a>>16&255,n[i++]=a>>24&255,n[i++]=255&h,n[i++]=h>>8&255,n[i++]=h>>16&255,n[i++]=h>>24&255,i}if(e instanceof Double||"Double"==e._bsontype){n[i++]=BSON.BSON_DATA_NUMBER;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,writeIEEE754(n,e,i,"little",52,8),i+=8}if(e instanceof Code||"Code"==e._bsontype){if(null!=e.scope&&Object.keys(e.scope).length>0){n[i++]=BSON.BSON_DATA_CODE_W_SCOPE;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var l=BSON.calculateObjectSize(e.scope,o),p=e.code.toString(),_=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1,g=4+_+l+4;n[i++]=255&g,n[i++]=g>>8&255,n[i++]=g>>16&255,n[i++]=g>>24&255,n[i++]=255&_,n[i++]=_>>8&255,n[i++]=_>>16&255,n[i++]=_>>24&255,supportsBuffer?n.write(p,i,"utf8"):writeToTypedArray(n,p,i),i=i+_-1,n[i++]=0;var y=supportsBuffer?new Buffer(l):new Uint8Array(new ArrayBuffer(l));serializeObject(e.scope,r,y,0,o);var b=l;return n[i++]=255&b,n[i++]=b>>8&255,n[i++]=b>>16&255,n[i++]=b>>24&255,supportsBuffer?y.copy(n,i,0,l):n.set(y,i),i=i+b-5,n[i++]=0,i}n[i++]=BSON.BSON_DATA_CODE;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var p=e.code.toString(),u=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1;return n[i++]=255&u,n[i++]=u>>8&255,n[i++]=u>>16&255,n[i++]=u>>24&255,supportsBuffer?n.write(p,i,"utf8"):writeToTypedArray(n,p,i),i=i+u-1,n[i++]=0,i}if(e instanceof Binary||"Binary"==e._bsontype){n[i++]=BSON.BSON_DATA_BINARY;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var d=e.value(!0),u=e.position;return n[i++]=255&u,n[i++]=u>>8&255,n[i++]=u>>16&255,n[i++]=u>>24&255,n[i++]=e.sub_type,e.sub_type==Binary.SUBTYPE_BYTE_ARRAY&&(n[i++]=255&u,n[i++]=u>>8&255,n[i++]=u>>16&255,n[i++]=u>>24&255),supportsBuffer?d.copy(n,i,0,e.position):n.set(d,i),i+=e.position}if(e instanceof Symbol||"Symbol"==e._bsontype){n[i++]=BSON.BSON_DATA_SYMBOL;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var u=supportsBuffer?Buffer.byteLength(e.value)+1:numberOfBytes(e.value)+1;return n[i++]=255&u,n[i++]=u>>8&255,n[i++]=u>>16&255,n[i++]=u>>24&255,n.write(e.value,i,"utf8"),i=i+u-1,n[i++]=0,i}if(e instanceof DBRef||"DBRef"==e._bsontype){n[i++]=BSON.BSON_DATA_OBJECT;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var B={$ref:e.namespace,$id:e.oid};null!=e.db&&(B.$db=e.db);var u=BSON.calculateObjectSize(B,o),O=BSON.serializeWithBufferAndIndex(B,r,n,i,o);return n[i++]=255&u,n[i++]=u>>8&255,n[i++]=u>>16&255,n[i++]=u>>24&255,n[O++]=0,O}if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)){n[i++]=BSON.BSON_DATA_REGEXP;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,supportsBuffer?n.write(e.source,i,"utf8"):writeToTypedArray(n,e.source,i),i+=supportsBuffer?Buffer.byteLength(e.source):numberOfBytes(e.source),n[i++]=0,e.global&&(n[i++]=115),e.ignoreCase&&(n[i++]=105),e.multiline&&(n[i++]=109),n[i++]=0,i}n[i++]=Array.isArray(e)?BSON.BSON_DATA_ARRAY:BSON.BSON_DATA_OBJECT;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var O=serializeObject(e,r,n,i+4,o),u=O-i;return n[i++]=255&u,n[i++]=u>>8&255,n[i++]=u>>16&255,n[i++]=u>>24&255,O;case"function":if(e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e)||"[object RegExp]"==String.call(e)){n[i++]=BSON.BSON_DATA_REGEXP;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);return i=i+f+1,n[i-1]=0,n.write(e.source,i,"utf8"),i+=supportsBuffer?Buffer.byteLength(e.source):numberOfBytes(e.source),n[i++]=0,e.global&&(n[i++]=115),e.ignoreCase&&(n[i++]=105),e.multiline&&(n[i++]=109),n[i++]=0,i}if(o&&null!=e.scope&&Object.keys(e.scope).length>0){n[i++]=BSON.BSON_DATA_CODE_W_SCOPE;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var l=BSON.calculateObjectSize(e.scope,o),p=e.toString(),_=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1,g=4+_+l;n[i++]=255&g,n[i++]=g>>8&255,n[i++]=g>>16&255,n[i++]=g>>24&255,n[i++]=255&_,n[i++]=_>>8&255,n[i++]=_>>16&255,n[i++]=_>>24&255,supportsBuffer?n.write(p,i,"utf8"):writeToTypedArray(n,p,i),i=i+_-1,n[i++]=0;var y=new Buffer(l);serializeObject(e.scope,r,y,0,o);var b=l-4;return n[i++]=255&b,n[i++]=b>>8&255,n[i++]=b>>16&255,n[i++]=b>>24&255,y.copy(n,i,0,l),i=i+b-5,n[i++]=0,i}if(o){n[i++]=BSON.BSON_DATA_CODE;var f=supportsBuffer?n.write(t,i,"utf8"):writeToTypedArray(n,t,i);i=i+f+1,n[i-1]=0;var p=e.toString(),u=supportsBuffer?Buffer.byteLength(p)+1:numberOfBytes(p)+1;return n[i++]=255&u,n[i++]=u>>8&255,n[i++]=u>>16&255,n[i++]=u>>24&255,supportsBuffer?n.write(p,i,"utf8"):writeToTypedArray(n,p,i),i=i+u-1,n[i++]=0,i}}return i};BSON.serialize=function(t,e,r,n){if(null==t||"object"!=typeof t||Array.isArray(t))throw new Error("Only javascript objects supported");var i=null,o=BSON.calculateObjectSize(t,n);return(i="undefined"!=typeof Buffer)?(i=new Buffer(o),r=!0):i="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(o)):new Array(o),BSON.serializeWithBufferAndIndex(t,e,i,0,n),i};var functionCache=BSON.functionCache={},table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],crc32=function(t,e,r){var n=0,i=0,o=0;
n=-1^n;for(var f=e,u=r;u>f;f++)o=255&(n^t[f]),i=table[o],n=n>>>8^i;return-1^n};BSON.deserializeStream=function(t,e,r,n,i,o){o=null!=o?o:{};for(var f=e,u=0;r>u;u++){var s=t[f]|t[f+1]<<8|t[f+2]<<16|t[f+3]<<24;o.index=f,n[i+u]=BSON.deserialize(t,o),f+=s}return f};var isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},convertUint8ArrayToUtf8String=function(t,e,r){return BinaryParser.decode_utf8(convertArraytoUtf8BinaryString(t,e,r))},convertArraytoUtf8BinaryString=function(t,e,r){for(var n="",i=e;r>i;i++)n+=String.fromCharCode(t[i]);return n};BSON.deserialize=function(t,e,r){e=null==e?{}:e;var n=null==e.evalFunctions?!1:e.evalFunctions,i=null==e.cacheFunctions?!1:e.cacheFunctions,o=null==e.cacheFunctionsCrc32?!1:e.cacheFunctionsCrc32,f=e.promoteLongs||!0;if(t.length<5)throw new Error("corrupt bson message < 5 bytes long");var u="number"==typeof e.index?e.index:0,s=function(){for(var e=u;0!==t[e];)e++;var r=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",u,e):convertUint8ArrayToUtf8String(t,u,e);return u=e+1,r},a=r?[]:{},h=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24;if(5>h||h>t.length)throw new Error("corrupt bson message");for(;;){var c=t[u++];if(0==c)break;var l=s();switch(c){case BSON.BSON_DATA_OID:var p=supportsBuffer&&Buffer.isBuffer(t)?t.toString("binary",u,u+12):convertArraytoUtf8BinaryString(t,u,u+12);a[l]=new ObjectID(p),u+=12;break;case BSON.BSON_DATA_STRING:var _=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24;a[l]=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",u,u+_-1):convertUint8ArrayToUtf8String(t,u,u+_-1),u+=_;break;case BSON.BSON_DATA_INT:a[l]=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24;break;case BSON.BSON_DATA_NUMBER:a[l]=readIEEE754(t,u,"little",52,8),u+=8;break;case BSON.BSON_DATA_DATE:var g=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24,y=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24;a[l]=new Date(new Long(g,y).toNumber());break;case BSON.BSON_DATA_BOOLEAN:a[l]=1==t[u++];break;case BSON.BSON_DATA_NULL:a[l]=null;break;case BSON.BSON_DATA_BINARY:var b=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24,d=t[u++];if(null!=t.slice)d==Binary.SUBTYPE_BYTE_ARRAY&&(b=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24),a[l]=new Binary(t.slice(u,u+b),d);else{var B="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(b)):new Array(b);d==Binary.SUBTYPE_BYTE_ARRAY&&(b=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24);for(var O=0;b>O;O++)B[O]=t[u+O];a[l]=new Binary(B,d)}u+=b;break;case BSON.BSON_DATA_ARRAY:e.index=u;var N=t[u]|t[u+1]<<8|t[u+2]<<16|t[u+3]<<24;a[l]=BSON.deserialize(t,e,!0),u+=N;break;case BSON.BSON_DATA_OBJECT:e.index=u;var N=t[u]|t[u+1]<<8|t[u+2]<<16|t[u+3]<<24;a[l]=BSON.deserialize(t,e,!1),u+=N;break;case BSON.BSON_DATA_REGEXP:for(var S=s(),m=s(),A=new Array(m.length),O=0;O<m.length;O++)switch(m[O]){case"m":A[O]="m";break;case"s":A[O]="g";break;case"i":A[O]="i"}a[l]=new RegExp(S,A.join(""));break;case BSON.BSON_DATA_LONG:var g=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24,y=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24,v=new Long(g,y);a[l]=f&&v.lessThanOrEqual(JS_INT_MAX_LONG)&&v.greaterThanOrEqual(JS_INT_MIN_LONG)?v.toNumber():v;break;case BSON.BSON_DATA_SYMBOL:var _=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24;a[l]=new Symbol(t.toString("utf8",u,u+_-1)),u+=_;break;case BSON.BSON_DATA_TIMESTAMP:var g=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24,y=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24;a[l]=new Timestamp(g,y);break;case BSON.BSON_DATA_MIN_KEY:a[l]=new MinKey;break;case BSON.BSON_DATA_MAX_KEY:a[l]=new MaxKey;break;case BSON.BSON_DATA_CODE:var _=t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24,w=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",u,u+_-1):convertUint8ArrayToUtf8String(t,u,u+_-1);if(n){if(i){var T=o?crc32(w):w;a[l]=isolateEvalWithHash(functionCache,T,w,a)}else a[l]=isolateEval(w)}else a[l]=new Code(w,{});u+=_;break;case BSON.BSON_DATA_CODE_W_SCOPE:var _=(t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24,t[u++]|t[u++]<<8|t[u++]<<16|t[u++]<<24),w=supportsBuffer&&Buffer.isBuffer(t)?t.toString("utf8",u,u+_-1):convertUint8ArrayToUtf8String(t,u,u+_-1);u+=_,e.index=u;var N=t[u]|t[u+1]<<8|t[u+2]<<16|t[u+3]<<24,E=BSON.deserialize(t,e,!1);if(u+=N,n){if(i){var T=o?crc32(w):w;a[l]=isolateEvalWithHash(functionCache,T,w,a)}else a[l]=isolateEval(w);a[l].scope=E}else a[l]=new Code(w,E)}}return null!=a.$id&&(a=new DBRef(a.$ref,a.$id,a.$db)),a},BSON.checkKey=function(t,e){if(t.length){if(~t.indexOf("\x00"))throw Error("key "+t+" must not contain null bytes");if(!e){if("$"==t[0])throw Error("key "+t+" must not start with '$'");if(~t.indexOf("."))throw Error("key "+t+" must not contain '.'")}}},BSON.prototype.deserialize=function(t,e){return BSON.deserialize(t,e)},BSON.prototype.deserializeStream=function(t,e,r,n,i,o){return BSON.deserializeStream(t,e,r,n,i,o)},BSON.prototype.serialize=function(t,e,r,n){return BSON.serialize(t,e,r,n)},BSON.prototype.calculateObjectSize=function(t,e){return BSON.calculateObjectSize(t,e)},BSON.prototype.serializeWithBufferAndIndex=function(t,e,r,n,i){return BSON.serializeWithBufferAndIndex(t,e,r,n,i)},exports.Code=Code,exports.Symbol=Symbol,exports.BSON=BSON,exports.DBRef=DBRef,exports.Binary=Binary,exports.ObjectID=ObjectID,exports.Long=Long,exports.Timestamp=Timestamp,exports.Double=Double,exports.MinKey=MinKey,exports.MaxKey=MaxKey},code:function(t,e){function r(t,e){return this instanceof r?(this._bsontype="Code",this.code=t,void(this.scope=null==e?{}:e)):new r(t,e)}r.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},e.Code=r},db_ref:function(t,e){function r(t,e,n){return this instanceof r?(this._bsontype="DBRef",this.namespace=t,this.oid=e,void(this.db=n)):new r(t,e,n)}r.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:null==this.db?"":this.db}},e.DBRef=r},"double":function(t,e){function r(t){return this instanceof r?(this._bsontype="Double",void(this.value=t)):new r(t)}r.prototype.valueOf=function(){return this.value},r.prototype.toJSON=function(){return this.value},e.Double=r},float_parser:function(t,e){var r=function(t,e,r,n,i){var o,f,u="big"===r,s=8*i-n-1,a=(1<<s)-1,h=a>>1,c=-7,l=u?0:i-1,p=u?1:-1,_=t[e+l];for(l+=p,o=_&(1<<-c)-1,_>>=-c,c+=s;c>0;o=256*o+t[e+l],l+=p,c-=8);for(f=o&(1<<-c)-1,o>>=-c,c+=n;c>0;f=256*f+t[e+l],l+=p,c-=8);if(0===o)o=1-h;else{if(o===a)return f?0/0:1/0*(_?-1:1);f+=Math.pow(2,n),o-=h}return(_?-1:1)*f*Math.pow(2,o-n)},n=function(t,e,r,n,i,o){var f,u,s,a="big"===n,h=8*o-i-1,c=(1<<h)-1,l=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,_=a?o-1:0,g=a?-1:1,y=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(u=isNaN(e)?1:0,f=c):(f=Math.floor(Math.log(e)/Math.LN2),e*(s=Math.pow(2,-f))<1&&(f--,s*=2),e+=f+l>=1?p/s:p*Math.pow(2,1-l),e*s>=2&&(f++,s/=2),f+l>=c?(u=0,f=c):f+l>=1?(u=(e*s-1)*Math.pow(2,i),f+=l):(u=e*Math.pow(2,l-1)*Math.pow(2,i),f=0));i>=8;t[r+_]=255&u,_+=g,u/=256,i-=8);for(f=f<<i|u,h+=i;h>0;t[r+_]=255&f,_+=g,f/=256,h-=8);t[r+_-g]|=128*y};e.readIEEE754=r,e.writeIEEE754=n},index:function(t,e,r,n){try{e.BSONPure=n("./bson"),e.BSONNative=n("../../ext")}catch(i){}["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long"].forEach(function(t){var r=n("./"+t);for(var i in r)e[i]=r[i]}),e.native=function(){var t={};return["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long","../../ext"].forEach(function(e){var r=n("./"+e);for(var i in r)t[i]=r[i]}),t},e.pure=function(){var t={};return["./binary_parser","./binary","./code","./db_ref","./double","./max_key","./min_key","./objectid","./symbol","./timestamp","./long","././bson"].forEach(function(e){var r=n("./"+e);for(var i in r)t[i]=r[i]}),t}},"long":function(t,e){function r(t,e){return this instanceof r?(this._bsontype="Long",this.low_=0|t,void(this.high_=0|e)):new r(t,e)}r.prototype.toInt=function(){return this.low_},r.prototype.toNumber=function(){return this.high_*r.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},r.prototype.toJSON=function(){return this.toString()},r.prototype.toString=function(t){var e=t||10;if(2>e||e>36)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(r.MIN_VALUE)){var n=r.fromNumber(e),i=this.div(n),o=i.multiply(n).subtract(this);return i.toString(e)+o.toInt().toString(e)}return"-"+this.negate().toString(e)}for(var f=r.fromNumber(Math.pow(e,6)),o=this,u="";;){var s=o.div(f),a=o.subtract(s.multiply(f)).toInt(),h=a.toString(e);if(o=s,o.isZero())return h+u;for(;h.length<6;)h="0"+h;u=""+h+u}},r.prototype.getHighBits=function(){return this.high_},r.prototype.getLowBits=function(){return this.low_},r.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:r.TWO_PWR_32_DBL_+this.low_},r.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(r.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high_?this.high_:this.low_,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high_?e+33:e+1},r.prototype.isZero=function(){return 0==this.high_&&0==this.low_},r.prototype.isNegative=function(){return this.high_<0},r.prototype.isOdd=function(){return 1==(1&this.low_)},r.prototype.equals=function(t){return this.high_==t.high_&&this.low_==t.low_},r.prototype.notEquals=function(t){return this.high_!=t.high_||this.low_!=t.low_},r.prototype.lessThan=function(t){return this.compare(t)<0},r.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},r.prototype.greaterThan=function(t){return this.compare(t)>0},r.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},r.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.subtract(t).isNegative()?-1:1},r.prototype.negate=function(){return this.equals(r.MIN_VALUE)?r.MIN_VALUE:this.not().add(r.ONE)},r.prototype.add=function(t){var e=this.high_>>>16,n=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,f=t.high_>>>16,u=65535&t.high_,s=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=o+a,l+=p>>>16,p&=65535,l+=i+s,c+=l>>>16,l&=65535,c+=n+u,h+=c>>>16,c&=65535,h+=e+f,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.subtract=function(t){return this.add(t.negate())},r.prototype.multiply=function(t){if(this.isZero())return r.ZERO;if(t.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE))return t.isOdd()?r.MIN_VALUE:r.ZERO;if(t.equals(r.MIN_VALUE))return this.isOdd()?r.MIN_VALUE:r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(r.TWO_PWR_24_)&&t.lessThan(r.TWO_PWR_24_))return r.fromNumber(this.toNumber()*t.toNumber());var e=this.high_>>>16,n=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,f=t.high_>>>16,u=65535&t.high_,s=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=o*a,l+=p>>>16,p&=65535,l+=i*a,c+=l>>>16,l&=65535,l+=o*s,c+=l>>>16,l&=65535,c+=n*a,h+=c>>>16,c&=65535,c+=i*s,h+=c>>>16,c&=65535,c+=o*u,h+=c>>>16,c&=65535,h+=e*a+n*s+i*u+o*f,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE)){if(t.equals(r.ONE)||t.equals(r.NEG_ONE))return r.MIN_VALUE;if(t.equals(r.MIN_VALUE))return r.ONE;var e=this.shiftRight(1),n=e.div(t).shiftLeft(1);if(n.equals(r.ZERO))return t.isNegative()?r.ONE:r.NEG_ONE;var i=this.subtract(t.multiply(n)),o=n.add(i.div(t));return o}if(t.equals(r.MIN_VALUE))return r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();for(var f=r.ZERO,i=this;i.greaterThanOrEqual(t);){for(var n=Math.max(1,Math.floor(i.toNumber()/t.toNumber())),u=Math.ceil(Math.log(n)/Math.LN2),s=48>=u?1:Math.pow(2,u-48),a=r.fromNumber(n),h=a.multiply(t);h.isNegative()||h.greaterThan(i);)n-=s,a=r.fromNumber(n),h=a.multiply(t);a.isZero()&&(a=r.ONE),f=f.add(a),i=i.subtract(h)}return f},r.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},r.prototype.not=function(){return r.fromBits(~this.low_,~this.high_)},r.prototype.and=function(t){return r.fromBits(this.low_&t.low_,this.high_&t.high_)},r.prototype.or=function(t){return r.fromBits(this.low_|t.low_,this.high_|t.high_)},r.prototype.xor=function(t){return r.fromBits(this.low_^t.low_,this.high_^t.high_)},r.prototype.shiftLeft=function(t){if(t&=63,0==t)return this;var e=this.low_;if(32>t){var n=this.high_;return r.fromBits(e<<t,n<<t|e>>>32-t)}return r.fromBits(0,e<<t-32)},r.prototype.shiftRight=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>t)}return r.fromBits(e>>t-32,e>=0?0:-1)},r.prototype.shiftRightUnsigned=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>>t)}return 32==t?r.fromBits(e,0):r.fromBits(e>>>t-32,0)},r.fromInt=function(t){if(t>=-128&&128>t){var e=r.INT_CACHE_[t];if(e)return e}var n=new r(0|t,0>t?-1:0);return t>=-128&&128>t&&(r.INT_CACHE_[t]=n),n},r.fromNumber=function(t){return isNaN(t)||!isFinite(t)?r.ZERO:t<=-r.TWO_PWR_63_DBL_?r.MIN_VALUE:t+1>=r.TWO_PWR_63_DBL_?r.MAX_VALUE:0>t?r.fromNumber(-t).negate():new r(t%r.TWO_PWR_32_DBL_|0,t/r.TWO_PWR_32_DBL_|0)},r.fromBits=function(t,e){return new r(t,e)},r.fromString=function(t,e){if(0==t.length)throw Error("number format error: empty string");var n=e||10;if(2>n||n>36)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return r.fromString(t.substring(1),n).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var i=r.fromNumber(Math.pow(n,8)),o=r.ZERO,f=0;f<t.length;f+=8){var u=Math.min(8,t.length-f),s=parseInt(t.substring(f,f+u),n);if(8>u){var a=r.fromNumber(Math.pow(n,u));o=o.multiply(a).add(r.fromNumber(s))}else o=o.multiply(i),o=o.add(r.fromNumber(s))}return o},r.INT_CACHE_={},r.TWO_PWR_16_DBL_=65536,r.TWO_PWR_24_DBL_=1<<24,r.TWO_PWR_32_DBL_=r.TWO_PWR_16_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_31_DBL_=r.TWO_PWR_32_DBL_/2,r.TWO_PWR_48_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_64_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_32_DBL_,r.TWO_PWR_63_DBL_=r.TWO_PWR_64_DBL_/2,r.ZERO=r.fromInt(0),r.ONE=r.fromInt(1),r.NEG_ONE=r.fromInt(-1),r.MAX_VALUE=r.fromBits(-1,2147483647),r.MIN_VALUE=r.fromBits(0,-2147483648),r.TWO_PWR_24_=r.fromInt(1<<24),e.Long=r},max_key:function(t,e){function r(){return this instanceof r?void(this._bsontype="MaxKey"):new r}e.MaxKey=r},min_key:function(t,e){function r(){return this instanceof r?void(this._bsontype="MinKey"):new r}e.MinKey=r},objectid:function(t,e,r,n){for(var i=n("./binary_parser").BinaryParser,o=parseInt(16777215*Math.random(),10),f=new RegExp("^[0-9a-fA-F]{24}$"),u=function h(t,e){if(!(this instanceof h))return new h(t,e);this._bsontype="ObjectID";if(null!=t&&"number"!=typeof t&&12!=t.length&&24!=t.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(null==t||"number"==typeof t)this.id=this.generate(t);else{if(null==t||12!==t.length){if(f.test(t))return h.createFromHexString(t);throw new Error("Value passed in is not a valid 24 character hex string")}this.id=t}h.cacheHexString&&(this.__id=this.toHexString())},s=[],a=0;256>a;a++)s[a]=(15>=a?"0":"")+a.toString(16);u.prototype.toHexString=function(){if(u.cacheHexString&&this.__id)return this.__id;for(var t="",e=0;e<this.id.length;e++)t+=s[this.id.charCodeAt(e)];return u.cacheHexString&&(this.__id=t),t},u.prototype.get_inc=function(){return u.index=(u.index+1)%16777215},u.prototype.getInc=function(){return this.get_inc()},u.prototype.generate=function(t){if("number"==typeof t)var e=i.encodeInt(t,32,!0,!0),r=i.encodeInt(o,24,!1),n=i.fromShort("undefined"==typeof process?Math.floor(1e5*Math.random()):process.pid),f=i.encodeInt(this.get_inc(),24,!1,!0);else var u=parseInt(Date.now()/1e3,10),e=i.encodeInt(u,32,!0,!0),r=i.encodeInt(o,24,!1),n=i.fromShort("undefined"==typeof process?Math.floor(1e5*Math.random()):process.pid),f=i.encodeInt(this.get_inc(),24,!1,!0);return e+r+n+f},u.prototype.toString=function(){return this.toHexString()},u.prototype.inspect=u.prototype.toString,u.prototype.toJSON=function(){return this.toHexString()},u.prototype.equals=function(t){var e=t instanceof u||t.toHexString?t.id:u.createFromHexString(t).id;return this.id===e},u.prototype.getTimestamp=function(){var t=new Date;return t.setTime(1e3*Math.floor(i.decodeInt(this.id.substring(0,4),32,!0,!0))),t},u.index=parseInt(16777215*Math.random(),10),u.createPk=function(){return new u},u.createFromTime=function(t){var e=i.encodeInt(t,32,!0,!0)+i.encodeInt(0,64,!0,!0);return new u(e)},u.createFromHexString=function(t){if("undefined"==typeof t||null!=t&&24!=t.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");var e=t.length;if(e>24)throw new Error("Id cannot be longer than 12 bytes");for(var r,n,o="",f=0;e>f;f+=2)r=t.substr(f,2),n=parseInt(r,16),o+=i.fromByte(n);return new u(o,t)},Object.defineProperty(u.prototype,"generationTime",{enumerable:!0,get:function(){return Math.floor(i.decodeInt(this.id.substring(0,4),32,!0,!0))},set:function(t){var t=i.encodeInt(t,32,!0,!0);this.id=t+this.id.substr(4),this.toHexString()}}),e.ObjectID=u,e.ObjectId=u},symbol:function(t,e){function r(t){return this instanceof r?(this._bsontype="Symbol",void(this.value=t)):new r(t)}r.prototype.valueOf=function(){return this.value},r.prototype.toString=function(){return this.value},r.prototype.inspect=function(){return this.value},r.prototype.toJSON=function(){return this.value},e.Symbol=r},timestamp:function(t,e){function r(t,e){return this instanceof r?(this._bsontype="Timestamp",this.low_=0|t,void(this.high_=0|e)):new r(t,e)}r.prototype.toInt=function(){return this.low_},r.prototype.toNumber=function(){return this.high_*r.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},r.prototype.toJSON=function(){return this.toString()},r.prototype.toString=function(t){var e=t||10;if(2>e||e>36)throw Error("radix out of range: "+e);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(r.MIN_VALUE)){var n=r.fromNumber(e),i=this.div(n),o=i.multiply(n).subtract(this);return i.toString(e)+o.toInt().toString(e)}return"-"+this.negate().toString(e)}for(var f=r.fromNumber(Math.pow(e,6)),o=this,u="";;){var s=o.div(f),a=o.subtract(s.multiply(f)).toInt(),h=a.toString(e);if(o=s,o.isZero())return h+u;for(;h.length<6;)h="0"+h;u=""+h+u}},r.prototype.getHighBits=function(){return this.high_},r.prototype.getLowBits=function(){return this.low_},r.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:r.TWO_PWR_32_DBL_+this.low_},r.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(r.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high_?this.high_:this.low_,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high_?e+33:e+1},r.prototype.isZero=function(){return 0==this.high_&&0==this.low_},r.prototype.isNegative=function(){return this.high_<0},r.prototype.isOdd=function(){return 1==(1&this.low_)},r.prototype.equals=function(t){return this.high_==t.high_&&this.low_==t.low_},r.prototype.notEquals=function(t){return this.high_!=t.high_||this.low_!=t.low_},r.prototype.lessThan=function(t){return this.compare(t)<0},r.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},r.prototype.greaterThan=function(t){return this.compare(t)>0},r.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},r.prototype.compare=function(t){if(this.equals(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.subtract(t).isNegative()?-1:1},r.prototype.negate=function(){return this.equals(r.MIN_VALUE)?r.MIN_VALUE:this.not().add(r.ONE)},r.prototype.add=function(t){var e=this.high_>>>16,n=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,f=t.high_>>>16,u=65535&t.high_,s=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=o+a,l+=p>>>16,p&=65535,l+=i+s,c+=l>>>16,l&=65535,c+=n+u,h+=c>>>16,c&=65535,h+=e+f,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.subtract=function(t){return this.add(t.negate())},r.prototype.multiply=function(t){if(this.isZero())return r.ZERO;if(t.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE))return t.isOdd()?r.MIN_VALUE:r.ZERO;if(t.equals(r.MIN_VALUE))return this.isOdd()?r.MIN_VALUE:r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(r.TWO_PWR_24_)&&t.lessThan(r.TWO_PWR_24_))return r.fromNumber(this.toNumber()*t.toNumber());var e=this.high_>>>16,n=65535&this.high_,i=this.low_>>>16,o=65535&this.low_,f=t.high_>>>16,u=65535&t.high_,s=t.low_>>>16,a=65535&t.low_,h=0,c=0,l=0,p=0;return p+=o*a,l+=p>>>16,p&=65535,l+=i*a,c+=l>>>16,l&=65535,l+=o*s,c+=l>>>16,l&=65535,c+=n*a,h+=c>>>16,c&=65535,c+=i*s,h+=c>>>16,c&=65535,c+=o*u,h+=c>>>16,c&=65535,h+=e*a+n*s+i*u+o*f,h&=65535,r.fromBits(l<<16|p,h<<16|c)},r.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return r.ZERO;if(this.equals(r.MIN_VALUE)){if(t.equals(r.ONE)||t.equals(r.NEG_ONE))return r.MIN_VALUE;if(t.equals(r.MIN_VALUE))return r.ONE;var e=this.shiftRight(1),n=e.div(t).shiftLeft(1);if(n.equals(r.ZERO))return t.isNegative()?r.ONE:r.NEG_ONE;var i=this.subtract(t.multiply(n)),o=n.add(i.div(t));return o}if(t.equals(r.MIN_VALUE))return r.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();for(var f=r.ZERO,i=this;i.greaterThanOrEqual(t);){for(var n=Math.max(1,Math.floor(i.toNumber()/t.toNumber())),u=Math.ceil(Math.log(n)/Math.LN2),s=48>=u?1:Math.pow(2,u-48),a=r.fromNumber(n),h=a.multiply(t);h.isNegative()||h.greaterThan(i);)n-=s,a=r.fromNumber(n),h=a.multiply(t);a.isZero()&&(a=r.ONE),f=f.add(a),i=i.subtract(h)}return f},r.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},r.prototype.not=function(){return r.fromBits(~this.low_,~this.high_)},r.prototype.and=function(t){return r.fromBits(this.low_&t.low_,this.high_&t.high_)},r.prototype.or=function(t){return r.fromBits(this.low_|t.low_,this.high_|t.high_)},r.prototype.xor=function(t){return r.fromBits(this.low_^t.low_,this.high_^t.high_)},r.prototype.shiftLeft=function(t){if(t&=63,0==t)return this;var e=this.low_;if(32>t){var n=this.high_;return r.fromBits(e<<t,n<<t|e>>>32-t)}return r.fromBits(0,e<<t-32)},r.prototype.shiftRight=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>t)}return r.fromBits(e>>t-32,e>=0?0:-1)},r.prototype.shiftRightUnsigned=function(t){if(t&=63,0==t)return this;var e=this.high_;if(32>t){var n=this.low_;return r.fromBits(n>>>t|e<<32-t,e>>>t)}return 32==t?r.fromBits(e,0):r.fromBits(e>>>t-32,0)},r.fromInt=function(t){if(t>=-128&&128>t){var e=r.INT_CACHE_[t];if(e)return e}var n=new r(0|t,0>t?-1:0);return t>=-128&&128>t&&(r.INT_CACHE_[t]=n),n},r.fromNumber=function(t){return isNaN(t)||!isFinite(t)?r.ZERO:t<=-r.TWO_PWR_63_DBL_?r.MIN_VALUE:t+1>=r.TWO_PWR_63_DBL_?r.MAX_VALUE:0>t?r.fromNumber(-t).negate():new r(t%r.TWO_PWR_32_DBL_|0,t/r.TWO_PWR_32_DBL_|0)},r.fromBits=function(t,e){return new r(t,e)},r.fromString=function(t,e){if(0==t.length)throw Error("number format error: empty string");var n=e||10;if(2>n||n>36)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return r.fromString(t.substring(1),n).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var i=r.fromNumber(Math.pow(n,8)),o=r.ZERO,f=0;f<t.length;f+=8){var u=Math.min(8,t.length-f),s=parseInt(t.substring(f,f+u),n);if(8>u){var a=r.fromNumber(Math.pow(n,u));o=o.multiply(a).add(r.fromNumber(s))}else o=o.multiply(i),o=o.add(r.fromNumber(s))}return o},r.INT_CACHE_={},r.TWO_PWR_16_DBL_=65536,r.TWO_PWR_24_DBL_=1<<24,r.TWO_PWR_32_DBL_=r.TWO_PWR_16_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_31_DBL_=r.TWO_PWR_32_DBL_/2,r.TWO_PWR_48_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_16_DBL_,r.TWO_PWR_64_DBL_=r.TWO_PWR_32_DBL_*r.TWO_PWR_32_DBL_,r.TWO_PWR_63_DBL_=r.TWO_PWR_64_DBL_/2,r.ZERO=r.fromInt(0),r.ONE=r.fromInt(1),r.NEG_ONE=r.fromInt(-1),r.MAX_VALUE=r.fromBits(-1,2147483647),r.MIN_VALUE=r.fromBits(0,-2147483648),r.TWO_PWR_24_=r.fromInt(1<<24),e.Timestamp=r}}),"undefined"!=typeof module&&module.exports&&(module.exports=bson,module.parent||bson()),"undefined"!=typeof window&&"undefined"==typeof require&&(window.require=bson.require)}),define("localdb/0.0.1/src/lib/collection",[],function(t,e,r){"use strict";var n,i,o,f,u;f=t("localdb/0.0.1/src/lib/utils"),i=t("localdb/0.0.1/src/lib/projection"),o=t("localdb/0.0.1/src/lib/update"),u=t("localdb/0.0.1/src/lib/where"),n=function(){function t(t,e){this.name=""+e.name+"_"+t,this.ls=e.ls,this.deserialize()}return t.prototype.deserialize=function(){return this.data=f.parse(this.ls.getItem(this.name))},t.prototype.serialize=function(){return this.ls.setItem(this.name,f.stringify(this.data))},t.prototype.drop=function(){return this.ls.removeItem(this.name)},t.prototype.insert=function(t){var e,r,n;if(this.deserialize(),f.isArray(t))for(r=0,n=t.length;n>r;r++)e=t[r],f.isObject(e)&&(null==e._id&&(e._id=f.createObjectId()),this.data.push(e));else f.isObject(t)&&(null==t._id&&(t._id=f.createObjectId()),this.data.push(t));return this.serialize()},t.prototype.update=function(t,e){var r;return null==e&&(e={}),r=e.where||{},this.deserialize(),this.data=o(this.data,t,r),this.serialize()},t.prototype.remove=function(t){var e,r;return null==t&&(t={}),r=t.where||{},this.deserialize(),this.data=function(){var t,n,i,o;for(i=this.data,o=[],t=0,n=i.length;n>t;t++)e=i[t],u(e,r)||o.push(e);return o}.call(this),this.serialize()},t.prototype.find=function(t){var e,r,n,o,f,s,a,h;for(null==t&&(t={}),f=t.where||{},n=t.projection||{},r=t.limit||-1,this.deserialize(),o=[],h=this.data,s=0,a=h.length;a>s;s++)if(e=h[s],u(e,f)){if(0===r)break;r-=1,o.push(e)}return i.generate(o,n)},t.prototype.findOne=function(t){return null==t&&(t={}),t.limit=1,this.find(t)},t}(),r.exports=n}),define("localdb/0.0.1/src/lib/projection",[],function(t,e,r){"use strict";var n,i,o,f;o=t("localdb/0.0.1/src/lib/utils"),n=t("localdb/0.0.1/src/lib/criteria"),i={},i.generate=function(t,e){var r;return"{}"===JSON.stringify(e)?t:function(){var n,i,o;for(o=[],n=0,i=t.length;i>n;n++)r=t[n],o.push(f(r,e));return o}()},f=function(t,e){var r,n,i,u,s,a,h,c,l,p;s={};for(i in e)if(c=e[i],-1!==i.indexOf(".$")){if(i=i.split(".")[0],!o.isArray(t[i])||0===t[i].length)continue;s[i]=[t[i][0]]}else{if(0===i.indexOf("$elemMatch")){if(!o.isArray(t)||0===t.length)continue;for(u=[],l=0,p=t.length;p>l;l++){n=t[l],r=!0;for(a in c)h=c[a],o.isObject(h)?console.log("TODO"):n[a]!==h&&(r=!1);r&&u.push(n)}return u}o.isObject(c)?s[i]=f(t[i],c):1===c&&(s[i]=t[i])}return s},r.exports=i}),define("localdb/0.0.1/src/lib/criteria",[],function(t,e,r){"use strict";var n,i,o,f,u,s,a,h,c,l=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};i=t("localdb/0.0.1/src/lib/utils"),u=function(t,e,r){return n.check(t[e.split(".")[0]],new function(){return this[e.substr(e.indexOf(".")+1)]=r})},a=function(t,e){return i.isNumber(t)&&t===e?!0:i.isArray(t)&&l.call(t,e)>=0?!0:!1},c=function(t,e){return i.isString(t)&&t===e?!0:i.isArray(t)&&l.call(t,e)>=0?!0:!1},h=function(t,e){var r,n,o;if(i.isString(t)&&e.test(t))return!0;if(i.isArray(t))for(n=0,o=t.length;o>n;n++)if(r=t[n],e.test(r))return!0;return!1},s=function(t,e,r){var i,o,f,u,s,a,h;for(o in r)if(f=r[o],"$not"===o)return n.check(t,new function(){return this[e]=f})?!1:!0;switch(e){case"$and":for(u=0,a=r.length;a>u;u++)if(i=r[u],!n.check(t,i))return!1;break;case"$nor":for(s=0,h=r.length;h>s;s++)if(i=r[s],n.check(t,i))return!1;break;case"$or":if(!function(){var e,o;for(e=0,o=r.length;o>e;e++)if(i=r[e],n.check(t,i))return!0}())return!1;break;default:return void 0}return!0},o=function(t,e,r){var f,u,s;switch(e){case"$all":if(!i.isArray(t))return!1;for(u=0,s=r.length;s>u;u++)if(f=r[u],!function(){var r,n,u;for(n=0,u=t.length;u>n;n++)if(r=t[n],i.isArray(f)?o(r,e,f):r===f)return!0}())return!1;break;case"$elemMatch":if(!i.isArray(t))return!1;if(!function(){var e,i,o;for(i=0,o=t.length;o>i;i++)if(e=t[i],n.check(e,r))return!0}())return!1;break;case"$size":if(!i.isArray(t))return!1;if(t.length!==r)return!1;break;default:return void 0}return!0},f=function(t,e,r){var o,f,u,s,a,h,c;for(o in r)switch(u=r[o],o){case"$gt":if(t[e]<=u)return!1;break;case"$gte":if(t[e]<u)return!1;break;case"$lt":if(t[e]>=u)return!1;break;case"$lte":if(t[e]>u)return!1;break;case"$ne":if(t[e]===u)return!1;break;case"$in":for(s=!0,a=0,h=u.length;h>a;a++){if(f=u[a],i.isRegex(f)&&f.test(t[e])){s=!1;break}if(t[e]===f){s=!1;break}}if(s)return!1;break;case"$nin":if(c=t[e],l.call(u,c)>=0)return!1;break;case"$exists":if(u!==(null!=t[e]))return!1;break;case"$type":if(!i.isType(t[e],u))return!1;break;case"$mod":if(t[e]%u[0]!==u[1])return!1;break;case"$regex":if(!new RegExp(u).test(t[e]))return!1;break;default:if(!n.check(t[e],JSON.parse('{"'+o+'": '+JSON.stringify(u)+"}")))return!1}return!0},n={},n.check=function(t,e){var r,n,l,p;for(l in e){if(n=e[l],-1!==l.indexOf(".")){if(u(t,l,n))continue;return!1}if(i.isNumber(n)&&"$size"!==l){if(a(t[l],n))continue;return!1}if(i.isString(n)){if(c(t[l],n))continue;return!1}if(i.isRegex(n)){if(h(t[l],n))continue;return!1}if(p=s(t,l,n),null!=p){if(p)continue;return!1}if(r=o(t,l,n),null!=r){if(r)continue;return!1}if(!f(t,l,n))return!1}return!0},r.exports=n}),define("localdb/0.0.1/src/lib/update",[],function(t,e,r){"use strict";var n,i,o,f;o=t("localdb/0.0.1/src/lib/where"),i=t("localdb/0.0.1/src/lib/utils"),f=function(t,e,r,n){var f,u,s,a,h,c,l,p,_,g,y,b,d,B,O,N,S,m,A;switch(e){case"$inc":for(u in r)for(s=r[u],a=0,p=t.length;p>a;a++)f=t[a],o(f,n)&&i.isNumber(f[u])&&(f[u]=f[u]+s);break;case"$set":for(u in r)for(s=r[u],h=0,_=t.length;_>h;h++)f=t[h],o(f,n)&&null!=f[u]&&(f[u]=s);break;case"$mul":for(u in r)for(s=r[u],c=0,g=t.length;g>c;c++)f=t[c],o(f,n)&&i.isNumber(f[u])&&(f[u]=f[u]*s);break;case"$rename":for(u in r)for(s=r[u],l=0,y=t.length;y>l;l++)f=t[l],o(f,n)&&null!=f[u]&&(f[s]=f[u],delete f[u]);break;case"$unset":for(u in r)for(N=0,b=t.length;b>N;N++)f=t[N],o(f,n)&&null!=f[u]&&delete f[u];break;case"$min":for(u in r)for(s=r[u],S=0,d=t.length;d>S;S++)f=t[S],o(f,n)&&i.isNumber(f[u])&&(f[u]=Math.min(f[u],s));break;case"$max":for(u in r)for(s=r[u],m=0,B=t.length;B>m;m++)f=t[m],o(f,n)&&i.isNumber(f[u])&&(f[u]=Math.max(f[u],s));break;default:for(A=0,O=t.length;O>A;A++)f=t[A],o(f,n)&&null!=f[e]&&(f[e]=r)}return t},n=function(t,e,r){var n,i;for(n in e)i=e[n],t=f(t,n,i,r);return t},r.exports=n}),define("localdb/0.0.1/src/lib/where",[],function(t,e,r){"use strict";var n,i,o,f,u,s,a,h,c,l,p,_,g=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};n=t("localdb/0.0.1/src/lib/utils"),l=["$gt","$gte","$lt","$lte","$ne","$in","$nin","$and","$nor","$or","$not","$exists","$type","$mod","$regex","$all","$elemMatch","$size"],u=function(t){return g.call(l,t)>=0},i=function(t,e){var r,n;for(n in e){if(r=e[n],null==t){if("$exists"===n&&r===!1)continue;return!1}if(-1!==n.indexOf(".")){if(f(t,n,r))continue;return!1}if(!_(t,n,r))return!1;if(!s(t,n,r))return!1}return!0},f=function(t,e,r){var n;return n=e.split(".")[0],i(t[/\d/.test(n)?Number(n):n],new function(){this[e.substr(e.indexOf(".")+1)]=r})},_=function(t,e,r){var i;return u(e)?!0:(i=t[e],n.isNumber(r)&&!a(i,r)?!1:n.isString(r)&&!p(i,r)?!1:n.isRegex(r)&&!c(i,r)?!1:n.isArray(r)&&!o(i,r)?!1:n.isObject(r)&&!h(i,r)?!1:!0)},s=function(t,e,r){var o,f,u,a,h,c,l;switch(e){case"$gt":if(r>=t)return!1;break;case"$gte":if(r>t)return!1;break;case"$lt":if(t>=r)return!1;break;case"$lte":if(t>r)return!1;
break;case"$ne":if(t===r)return!1;break;case"$in":if(!function(){var e,i,o;for(i=0,o=r.length;o>i;i++)if(e=r[i],n.isRegex(e)&&e.test(t)||t===e)return!0;return!1}())return!1;break;case"$nin":if(g.call(r,t)>=0)return!1;break;case"$exists":if(r!==(null!=t))return!1;break;case"$type":if(!n.isType(t,r))return!1;break;case"$mod":if(t%r[0]!==r[1])return!1;break;case"$regex":if(!new RegExp(r).test(t))return!1;break;case"$and":for(f=0,h=r.length;h>f;f++)if(o=r[f],!i(t,o))return!1;break;case"$nor":for(u=0,c=r.length;c>u;u++)if(o=r[u],i(t,o))return!1;break;case"$or":if(!function(){var e,n;for(e=0,n=r.length;n>e;e++)if(o=r[e],i(t,o))return!0;return!1}())return!1;break;case"$not":if(i(t,r))return!1;break;case"$all":if(!n.isArray(t))return!1;for(a=0,l=r.length;l>a;a++)if(o=r[a],!function(){var r,i,f;for(i=0,f=t.length;f>i;i++)if(r=t[i],n.isArray(o)?s(r,e,o):r===o)return!0}())return!1;break;case"$elemMatch":if(!n.isArray(t))return!1;if(!function(){var e,n,o;for(n=0,o=t.length;o>n;n++)if(e=t[n],i(e,r))return!0}())return!1;break;case"$size":if(!n.isArray(t))return!1;if(t.length!==r)return!1}return!0},a=function(t,e){return n.isNumber(t)&&e===t?!0:n.isArray(t)&&g.call(t,e)>=0?!0:!1},p=function(t,e){return n.isString(t)&&e===t?!0:n.isArray(t)&&g.call(t,e)>=0?!0:!1},c=function(t,e){var r,i,o;if(n.isString(t)&&e.test(t))return!0;if(n.isArray(t))for(i=0,o=t.length;o>i;i++)if(r=t[i],e.test(r))return!0;return!1},o=function(t,e){return n.isEqual(t,e)},h=function(t,e){var r,o,f;o=!0;for(f in e)if(r=e[f],u(f)&&(o=!1,!i(t,new function(){this[f]=r})))return!1;return o?n.isEqual(t,r):!0},r.exports=i});