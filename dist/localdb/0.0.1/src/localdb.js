define("localdb/0.0.1/src/localdb",[],function(t,e,r){var n,i,s,a,o,l,u,f,c,h,p,d,g,b,k=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};a="ldb_",b=function(t){return function(e){return{}.toString.call(e)==="[object "+t.toLowerCase().replace(/\w/,function(t){return t.toUpperCase()})+"]"}},p=function(t,e){return b(e)(t)},f=b("object"),h=b("string"),o=b("array"),l=b("function"),u=b("number"),c=b("regexp"),d=function(t){return null!=t&&h(t)?JSON.parse(t):[]},g=function(t){return null!=t&&o(t)?JSON.stringify(t):"[]"},s=function(t,e){var r,n,i,a,o,l,f,d,g,b,y,m,$,v,z;for(f in e){if(a=e[f],h(a)||u(a)){if(null!=t[f]&&t[f]===a)continue;return!1}if(c(a)){if(a.test(t[f]))continue;return!1}switch(l=!0,f){case"$and":for(d=0,y=a.length;y>d;d++)if(r=a[d],!s(t,r))return!1;break;case"$not":if(s(t,a))return!1;break;case"$nor":for(g=0,m=a.length;m>g;g++)if(r=a[g],s(t,r))return!1;break;case"$or":for(o=!1,b=0,$=a.length;$>b;b++)if(r=a[b],s(t,r)){o=!0;break}if(!o)return!1;break;default:l=!1}if(!l)for(n in a)switch(i=a[n],n){case"$gt":if(t[f]<=i)return!1;break;case"$gte":if(t[f]<i)return!1;break;case"$lt":if(t[f]>=i)return!1;break;case"$lte":if(t[f]>i)return!1;break;case"$ne":if(t[f]===i)return!1;break;case"$in":if(v=t[f],k.call(i,v)<0)return!1;break;case"$nin":if(z=t[f],k.call(i,z)>=0)return!1;break;case"$exist":if(i!==(null!=t[f]))return!1;break;case"$type":if(!p(t[f],i))return!1;break;case"$mod":if(t[f]%i[0]!==i[1])return!1;break;case"$regex":if(!new RegExp(i).test(t[f]))return!1;break;default:if(!s(t[f],JSON.parse('{"'+n+'": '+JSON.stringify(i)+"}")))return!1}}return!0},i=function(t,e){null==e&&(e=localStorage),this.ls=e,this.name=a+t},i.isSupport=function(){return"undefined"!=typeof localStorage&&null!==localStorage?!0:!1},i.prototype.collections=function(){var t,e,r,n;for(n=[],t=e=0,r=this.ls.length;r>=0?r>e:e>r;t=r>=0?++e:--e)0===this.ls.key(t).indexOf(""+this.name+"_")&&n.push(this.ls.key(t));return n},i.prototype.drop=function(t){var e,r,n,i,s;for(t=null!=t?"_"+t:"",n=function(){var r,n,i;for(i=[],e=r=0,n=this.ls.length;n>=0?n>r:r>n;e=n>=0?++r:--r)0===this.ls.key(e).indexOf(this.name+t)&&i.push(this.ls.key(e));return i}.call(this),i=0,s=n.length;s>i;i++)r=n[i],this.ls.removeItem(r);return!0},i.prototype.collection=function(t){return new n(t,this)},n=function(t,e){this.name=""+e.name+"_"+t,this.ls=e.ls,this.deserialize()},n.prototype.deserialize=function(){return this.data=d(this.ls.getItem(this.name))},n.prototype.serialize=function(){return this.ls.setItem(this.name,g(this.data))},n.prototype.drop=function(){return this.ls.removeItem(this.name)},n.prototype.insert=function(t){return this.deserialize(),this.data.push(t),this.serialize()},n.prototype.update=function(t,e){var r,n,i,a,o,l,u,f;for(n=null!=e.criteria?e.criteria:{},this.deserialize(),f=this.data,l=0,u=f.length;u>l;l++)if(i=f[l],s(i,n)){r=t.$set;for(a in r)o=r[a],i[a]=o}return this.serialize()},n.prototype.remove=function(t){var e,r;return null==t&&(t={}),e=null!=t.criteria?t.criteria:{},this.deserialize(),this.data=function(){var t,n,i,a;for(i=this.data,a=[],t=0,n=i.length;n>t;t++)r=i[t],s(r,e)||a.push(r);return a}.call(this),this.serialize()},n.prototype.find=function(t){var e,r,n,i,a,o,l,u,f,c,h,p,d,g;for(null==t&&(t={}),e=null!=t.criteria?t.criteria:{},l=null!=t.projection?t.projection:{},i=null!=t.limit?t.limit:-1,this.deserialize(),u=[],g=this.data,c=0,p=g.length;p>c;c++)if(r=g[c],s(r,e)){if(0===i)break;i-=1,u.push(r)}if("{}"===JSON.stringify(l))return u;for(o=[],h=0,d=u.length;d>h;h++){r=u[h],a={};for(n in l)f=l[n],1===f&&(a[n]=r[n]);o.push(a)}return o},n.prototype.findOne=function(t){return null==t&&(t={}),t.limit=1,this.find(t)},r.exports=i});