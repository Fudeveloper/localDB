/*! localDB - v0.1.1 - 2014-08-31
* localdb.emptystack.net
* Copyright (c) 2014 Eric Wang; Licensed MIT */
define(function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p;m=window.localStorage,e="ldb_",p=function(a){return function(b){return{}.toString.call(b)==="[object "+a.toLowerCase().replace(/\w/,function(a){return a.toUpperCase()})+"]"}},k=function(a,b){return p(b)(a)},i=p("object"),j=p("string"),f=p("array"),g=p("function"),h=p("number"),n=function(a){return null!=a&&j(a)?JSON.parse(a):[]},o=function(a){return null!=a&&f(a)?JSON.stringify(a):"[]"},d=function(a,b){var c,d,e,f;for(f in b)if(e=b[f],i(e))for(c in e)switch(d=e[c],c){case"$gt":if(a[f]<=d)return!1;break;case"$gte":if(a[f]<d)return!1;break;case"$lt":if(a[f]>=d)return!1;break;case"$lte":if(a[f]>d)return!1;break;case"$ne":if(a[f]===d)return!1}else if(a[f]!==e)return!1;return!0},l=l||function(a,b){m=b,this.db=e+a,null==m.getItem(this.db)&&m.setItem(this.db,"_"),this.length=function(){return this.collections().length}},l.isSupport=function(){return"undefined"!=typeof localStorage&&null!==localStorage?!0:!1},l.prototype.drop=function(a){var b,c,d,e,f;for(a=null!=a?"_"+a:"",d=function(){var c,d,e;for(e=[],b=c=0,d=m.length;d>=0?d>c:c>d;b=d>=0?++c:--c)0===m.key(b).indexOf(this.db+a)&&e.push(m.key(b));return e}.call(this),e=0,f=d.length;f>e;e++)c=d[e],m.removeItem(c)},l.prototype.collections=function(){var a,b,c,d;if(null!=this.db){for(d=[],a=b=0,c=m.length;c>=0?c>b:b>c;a=c>=0?++b:--b)0===m.key(a).indexOf(""+this.db+"_")&&d.push(m.key(a));return d}return[]},l.prototype.insert=function(a,b){var c;return a=""+this.db+"_"+a,c=m.getItem(a),c=n(c),c.push(b),m.setItem(a,o(c)),this},l.prototype.find=function(a,b){var c,e,f,g,h,i,j,k,l,o,p,q,r,s,t;for(null==b&&(b={}),f=null!=b.criteria?b.criteria:{},k=null!=b.projection?b.projection:{},j=null!=b.limit?b.limit:-1,a=""+this.db+"_"+a,e=m.getItem(a),null==e&&(e="[]"),e=n(e),h=[],q=0,s=e.length;s>q;q++)if(c=e[q],d(c,f)){if(0===j)break;j-=1,h.push(c)}if("{}"===JSON.stringify(k))return h;for(o=[],r=0,t=h.length;t>r;r++){g=h[r],l={};for(i in k)p=k[i],1===p&&(l[i]=g[i]);o.push(l)}return o},l.prototype.findOne=function(a,b){return null==b&&(b={}),b.limit=1,this.find(a,b)},l.prototype.update=function(a,b){var c,e,f,g,h,i,j,k,l;for(null==b&&(b={}),c=b.action,h=null!=b.criteria?b.criteria:{},a=""+this.db+"_"+a,g=m.getItem(a),null==g&&(g="[]"),g=n(g),k=0,l=g.length;l>k;k++)if(f=g[k],d(f,h)){e=c.$set;for(i in e)j=e[i],f[i]=j}return m.setItem(a,o(g))},l.prototype.remove=function(a,b){var c,e,f;return null==b&&(b={}),f=null!=b.criteria?b.criteria:{},a=""+this.db+"_"+a,e=m.getItem(a),null==e&&(e="[]"),e=n(e),m.setItem(a,o(function(){var a,b,g;for(g=[],a=0,b=e.length;b>a;a++)c=e[a],d(c,f)||g.push(c);return g}()))},c.exports=l});