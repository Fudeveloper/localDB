/*! localDB - v0.1.1 - 2014-08-31
* localdb.emptystack.net
* Copyright (c) 2014 Eric Wang; Licensed MIT */
define(function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p;m=window.localStorage,e="ldb_",p=function(a){return function(b){return{}.toString.call(b)==="[object "+a.toLowerCase().replace(/\w/,function(a){return a.toUpperCase()})+"]"}},k=function(a,b){return p(b)(a)},i=p("object"),j=p("string"),f=p("array"),g=p("function"),h=p("number"),n=function(a){return null!=a&&j(a)?JSON.parse(a):[]},o=function(a){return null!=a&&f(a)?JSON.stringify(a):"[]"},d=function(a,b){var c,d,e,f;for(f in b){e=b[f];for(c in e)switch(d=e[c],c){case"$gt":if(a[f]<=d)return!1;break;case"$gte":if(a[f]<d)return!1;break;case"$lt":if(a[f]>=d)return!1;break;case"$lte":if(a[f]>d)return!1;break;case"$ne":if(a[f]===d)return!1;break;case"$eq":if(a[f]!==d)return!1}}return!0},l=l||function(a,b){m=b,this.db=e+a,null==m.getItem(this.db)&&m.setItem(this.db,"_"),this.length=function(){return this.collections().length}},l.isSupport=function(){return"undefined"!=typeof localStorage&&null!==localStorage?!0:!1},l.prototype.drop=function(a){var b,c,d,e,f;for(a=null!=a?"_"+a:"",d=function(){var c,d,e;for(e=[],b=c=0,d=m.length;d>=0?d>c:c>d;b=d>=0?++c:--c)0===m.key(b).indexOf(this.db+a)&&e.push(m.key(b));return e}.call(this),e=0,f=d.length;f>e;e++)c=d[e],m.removeItem(c)},l.prototype.collections=function(){var a,b,c,d;if(null!=this.db){for(d=[],a=b=0,c=m.length;c>=0?c>b:b>c;a=c>=0?++b:--b)0===m.key(a).indexOf(""+this.db+"_")&&d.push(m.key(a));return d}return[]},l.prototype.insert=function(a,b){var c;return a=""+this.db+"_"+a,c=m.getItem(a),c=n(c),c.push(b),m.setItem(a,o(c)),this},l.prototype.find=function(a,b,c){var e,f,g,h,i;for(null==b&&(b={}),null==c&&(c=-1),a=""+this.db+"_"+a,f=m.getItem(a),null==f&&(f="[]"),f=n(f),g=[],h=0,i=f.length;i>h;h++)if(e=f[h],d(e,b)){if(0===c)break;c-=1,g.push(e)}return g},l.prototype.update=function(a,b,c){var e,f,g,h,i,j,k;for(null==c&&(c={}),a=""+this.db+"_"+a,g=m.getItem(a),null==g&&(g="[]"),g=n(g),j=0,k=g.length;k>j;j++)if(f=g[j],d(f,c)){e=b.$set;for(h in e)i=e[h],f[h]=i}return m.setItem(a,o(g))},l.prototype.remove=function(a,b){var c,e;return null==b&&(b={}),a=""+this.db+"_"+a,e=m.getItem(a),null==e&&(e="[]"),e=n(e),m.setItem(a,o(function(){var a,f,g;for(g=[],a=0,f=e.length;f>a;a++)c=e[a],d(c,b)||g.push(c);return g}()))},c.exports=l});