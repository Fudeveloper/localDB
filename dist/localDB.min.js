/*! localDB - v0.1.1 - 2014-08-29
* localdb.emptystack.net
* Copyright (c) 2014 Eric Wang; Licensed MIT */
define(function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;o=window.localStorage,f="ldb_",r=function(a){return function(b){return{}.toString.call(b)==="[object "+a.toLowerCase().replace(/\w/,function(a){return a.toUpperCase()})+"]"}},m=function(a,b){return r(b)(a)},k=r("object"),l=r("string"),h=r("array"),i=r("function"),j=r("number"),p=function(a){return null!=a&&l(a)?JSON.parse(a):[]},q=function(a){return null!=a&&h(a)?JSON.stringify(a):"[]"},e=function(a,b){var c,d,e,f;for(f in b){e=b[f];for(c in e)switch(d=e[c],c){case"$gt":if(a[f]<=d)return!1;break;case"$gte":if(a[f]<d)return!1;break;case"$lt":if(a[f]>=d)return!1;break;case"$lte":if(a[f]>d)return!1;break;case"$ne":if(a[f]===d)return!1;break;case"$eq":if(a[f]!==d)return!1}}return!0},n=n||function(a){this.db=f+a,null!=o.getItem(this.db)&&o.setItem(this.db,"_"),this.length=function(){return this.collections().length}},n.prototype.collections=function(){var a,b,c,d;if(null!=this.db){for(d=[],a=b=0,c=o.length;c>=0?c>b:b>c;a=c>=0?++b:--b)0===o.key(a).indexOf(""+this.db+"_")&&d.push(o.key(a));return d}return[]},n.prototype.clear=function(){var a,b,c;for(a=b=0,c=o.length;c>=0?c>b:b>c;a=c>=0?++b:--b)0===o.key(a).indexOf(""+this.db+"_")&&o.removeItem(o.key(a));return this},n.prototype.insert=function(a,b){var c;return a=""+this.db+"_"+a,c=o.getItem(a),c=p(c),c.push(b),o.setItem(a,q(c)),this},n.prototype.find=function(a,b,c){var d,f,g,h,i;for(null==b&&(b={}),null==c&&(c=-1),a=""+this.db+"_"+a,f=o.getItem(a),null==f&&(f="[]"),f=p(f),g=[],h=0,i=f.length;i>h;h++)if(d=f[h],e(d,b)){if(0===c)break;c-=1,g.push(d)}return g},n.prototype.update=function(a,b,c){var d,f,g,h,i,j,k;for(null==c&&(c={}),a=""+this.db+"_"+a,g=o.getItem(a),null==g&&(g="[]"),g=p(g),j=0,k=g.length;k>j;j++)if(f=g[j],e(f,c)){d=b.$set;for(h in d)i=d[h],f[h]=i}return o.setItem(a,q(g))},n.prototype.remove=function(a,b){var c,d;return null==b&&(b={}),a=""+this.db+"_"+a,d=o.getItem(a),null==d&&(d="[]"),d=p(d),o.setItem(a,q(function(){var a,f,g;for(g=[],a=0,f=d.length;f>a;a++)c=d[a],e(c,b)||g.push(c);return g}()))},console.log("Current Keys:"),console.log(function(){var a,b,c;for(c=[],g=a=0,b=o.length;b>=0?b>a:a>b;g=b>=0?++a:--a)c.push(o.key(g));return c}()),console.log("Create new db:"),d=new n("abc"),console.log(d),console.log("Show Collections:"),console.log(d.collections()),console.log("Clear collecionts:"),console.log(d.clear()),console.log("Insert data in Collection 1"),d.insert("collection1",{a:1,b:2,c:3}),d.insert("collection1",{a:2,b:2,c:3}),d.insert("collection1",{a:3,b:2,c:3}),d.insert("collection1",{a:4,b:2,c:3}),d.insert("collection1",{a:5,b:2,c:3}),d.insert("collection1",{a:6,b:2,c:3}),d.insert("collection1",{a:7,b:2,c:3}),d.insert("collection1",{a:8,b:2,c:3}),d.insert("collection1",{a:9,b:2,c:3}),d.insert("collection1",{a:10,b:2,c:3}),d.insert("collection1",{a:11,b:2,c:3}),d.insert("collection1",{a:12,b:2,c:3}),d.insert("collection2",{a:1,b:2,c:3}),console.log("Query data by criteria"),console.log(d.find("collection1",{a:{$gt:3,$lt:10}})),console.log("Query data by criteria and limit"),console.log(d.find("collection1",{a:{$gt:3,$lt:10}},4)),console.log("Update data by criteria and action"),d.update("collection1",{$set:{b:4,c:5}},{a:{$gt:3,$lt:10}}),console.log(d.find("collection1")),console.log("Delete data by criteria"),d.remove("collection1",{a:{$gt:3,$lt:10}}),console.log(d.find("collection1")),console.log("Show Collections:"),console.log(d.collections()),c.exports=n});